<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>4E Event Planner</title>
    
    <!-- Firebase SDK -->
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-database-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-auth-compat.js"></script>
    
    <style>
        /* [All your existing styles remain exactly the same] */
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: linear-gradient(135deg, #0f172a 0%, #1e293b 100%);
            color: #e2e8f0;
            height: 100vh;
            overflow: hidden;
        }

        /* Project Selection Modal - Enhanced */
        .project-modal {
            display: none;
            position: fixed;
            z-index: 9999;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.8);
            backdrop-filter: blur(8px);
        }

        .project-modal-content {
            background: linear-gradient(135deg, #1e293b 0%, #334155 100%);
            margin: 5% auto;
            padding: 0;
            border-radius: 16px;
            width: 90%;
            max-width: 600px;
            max-height: 80vh;
            overflow: hidden;
            border: 1px solid #475569;
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.5);
        }

        .project-modal-header {
            background: rgba(15, 23, 42, 0.8);
            padding: 24px 32px;
            border-bottom: 1px solid #475569;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .project-modal-title {
            font-size: 1.5rem;
            font-weight: 700;
            color: #f1f5f9;
        }

        .project-modal-body {
            padding: 32px;
            max-height: 60vh;
            overflow-y: auto;
        }

        .project-list {
            display: grid;
            gap: 16px;
            margin-bottom: 24px;
        }

        .project-item {
            background: rgba(71, 85, 105, 0.3);
            border: 1px solid #475569;
            border-radius: 12px;
            padding: 20px;
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            justify-content: space-between;
            align-items: center;
            position: relative;
        }

        .project-item:hover {
            background: rgba(59, 130, 246, 0.2);
            border-color: #3b82f6;
            transform: translateY(-2px);
        }

        .project-info h3 {
            color: #f1f5f9;
            font-size: 1.1rem;
            margin-bottom: 4px;
        }

        .project-info p {
            color: #94a3b8;
            font-size: 0.85rem;
        }

        .project-status {
            display: flex;
            align-items: center;
            gap: 8px;
            color: #10b981;
            font-size: 0.8rem;
        }

        .project-status.offline {
            color: #6b7280;
        }

        .online-indicator {
            width: 8px;
            height: 8px;
            border-radius: 50%;
            background: #10b981;
            animation: pulse 2s infinite;
        }

        .offline-indicator {
            width: 8px;
            height: 8px;
            border-radius: 50%;
            background: #6b7280;
        }

        @keyframes pulse {
            0% { opacity: 1; }
            50% { opacity: 0.5; }
            100% { opacity: 1; }
        }

        .new-project-section {
            border-top: 1px solid #475569;
            padding-top: 24px;
        }

        .new-project-buttons {
            display: grid;
            gap: 12px;
        }

        .new-project-btn {
            width: 100%;
            background: linear-gradient(135deg, #3b82f6 0%, #6366f1 100%);
            color: white;
            border: none;
            padding: 16px 24px;
            border-radius: 12px;
            cursor: pointer;
            font-weight: 600;
            font-size: 1rem;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
        }

        .new-project-btn:hover {
            background: linear-gradient(135deg, #2563eb 0%, #4f46e5 100%);
            transform: translateY(-1px);
        }

        .new-project-btn.template {
            background: linear-gradient(135deg, #10b981 0%, #059669 100%);
        }

        .new-project-btn.template:hover {
            background: linear-gradient(135deg, #059669 0%, #047857 100%);
        }

        /* Password Keypad Modal */
        .password-modal {
            display: none;
            position: fixed;
            z-index: 10000;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.8);
            backdrop-filter: blur(8px);
            overflow-y: auto;
        }

        .password-modal-content {
            background: linear-gradient(135deg, #1e293b 0%, #334155 100%);
            margin: 3% auto;
            padding: 32px;
            border-radius: 16px;
            width: 90%;
            max-width: 400px;
            max-height: 94vh;
            overflow-y: auto;
            border: 1px solid #475569;
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.5);
            text-align: center;
        }

        .password-title {
            color: #f1f5f9;
            font-size: 1.3rem;
            font-weight: 600;
            margin-bottom: 8px;
        }

        .password-subtitle {
            color: #94a3b8;
            font-size: 0.9rem;
            margin-bottom: 24px;
        }

        .password-display {
            background: rgba(15, 23, 42, 0.5);
            border: 1px solid #475569;
            border-radius: 8px;
            padding: 16px;
            margin-bottom: 24px;
            font-size: 1.5rem;
            letter-spacing: 0.5em;
            color: #e2e8f0;
            min-height: 60px;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .password-keypad {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 12px;
            margin-bottom: 24px;
        }

        .keypad-btn {
            background: rgba(71, 85, 105, 0.5);
            border: 1px solid #475569;
            color: #e2e8f0;
            padding: 20px;
            border-radius: 8px;
            font-size: 1.3rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.2s ease;
        }

        .keypad-btn:hover {
            background: rgba(59, 130, 246, 0.3);
            border-color: #3b82f6;
            transform: scale(1.05);
        }

        .keypad-btn:active {
            transform: scale(0.95);
        }

        .keypad-btn.clear {
            background: rgba(239, 68, 68, 0.2);
            border-color: rgba(239, 68, 68, 0.3);
        }

        .keypad-btn.clear:hover {
            background: rgba(239, 68, 68, 0.3);
        }

        .keypad-btn.submit {
            background: linear-gradient(135deg, #3b82f6 0%, #6366f1 100%);
            border: none;
            color: white;
        }

        .keypad-btn.submit:hover {
            background: linear-gradient(135deg, #2563eb 0%, #4f46e5 100%);
        }

        .password-actions {
            display: flex;
            gap: 12px;
        }

        .password-cancel {
            flex: 1;
            background: rgba(148, 163, 184, 0.1);
            color: #94a3b8;
            border: 1px solid rgba(148, 163, 184, 0.2);
            padding: 12px 20px;
            border-radius: 8px;
            cursor: pointer;
            font-weight: 600;
            transition: all 0.3s ease;
        }

        .password-cancel:hover {
            background: rgba(148, 163, 184, 0.2);
            color: #e2e8f0;
        }

        /* Project Actions */
        .project-actions {
            position: absolute;
            top: 20px;
            right: 20px;
            display: flex;
            gap: 8px;
            opacity: 0;
            transition: opacity 0.2s ease;
        }

        .project-item:hover .project-actions {
            opacity: 1;
        }

        .project-action-btn {
            background: rgba(239, 68, 68, 0.2);
            color: #ef4444;
            border: 1px solid rgba(239, 68, 68, 0.3);
            padding: 4px 8px;
            border-radius: 4px;
            cursor: pointer;
            font-size: 0.75rem;
            font-weight: 600;
            transition: all 0.2s ease;
        }

        .project-action-btn:hover {
            background: rgba(239, 68, 68, 0.3);
        }

        /* Admin Section */
        .admin-section {
            background: rgba(239, 68, 68, 0.1);
            border: 1px solid rgba(239, 68, 68, 0.3);
            border-radius: 12px;
            padding: 20px;
            margin-bottom: 24px;
        }

        .admin-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 16px;
        }

        .admin-title {
            color: #ef4444;
            font-size: 1.1rem;
            font-weight: 600;
        }

        .admin-btn {
            background: rgba(239, 68, 68, 0.2);
            color: #ef4444;
            border: 1px solid rgba(239, 68, 68, 0.3);
            padding: 8px 16px;
            border-radius: 8px;
            cursor: pointer;
            font-weight: 600;
            transition: all 0.3s ease;
        }

        .admin-btn:hover {
            background: rgba(239, 68, 68, 0.3);
        }

        .admin-content {
            display: none;
        }

        .admin-content.active {
            display: block;
        }

        .admin-project-list {
            max-height: 300px;
            overflow-y: auto;
            background: rgba(15, 23, 42, 0.5);
            border: 1px solid #475569;
            border-radius: 8px;
            padding: 12px;
        }

        .admin-project-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 8px;
            margin-bottom: 8px;
            background: rgba(71, 85, 105, 0.3);
            border: 1px solid #475569;
            border-radius: 6px;
        }

        .admin-project-item:last-child {
            margin-bottom: 0;
        }

        .admin-project-info {
            flex: 1;
        }

        .admin-project-name {
            color: #f1f5f9;
            font-weight: 600;
            font-size: 0.9rem;
        }

        .admin-project-details {
            color: #94a3b8;
            font-size: 0.75rem;
            margin-top: 2px;
        }

        .connection-status {
			background: rgba(15, 23, 42, 0.9);
			border: 1px solid #334155;
			border-radius: 8px;
			padding: 8px 12px;
			display: flex;
			align-items: center;
			gap: 6px;
			font-size: 0.85rem;
			backdrop-filter: blur(8px);
		}

        .connection-status.connected {
            border-color: #10b981;
            color: #10b981;
        }

        .connection-status.disconnected {
            border-color: #ef4444;
            color: #ef4444;
        }

        .sync-indicator {
            position: fixed;
            bottom: 20px;
            right: 20px;
            background: rgba(59, 130, 246, 0.9);
            color: white;
            padding: 12px 20px;
            border-radius: 8px;
            font-size: 0.85rem;
            font-weight: 600;
            display: none;
            z-index: 1000;
            animation: slideUp 0.3s ease;
        }

        @keyframes slideUp {
            from { transform: translateY(100px); opacity: 0; }
            to { transform: translateY(0); opacity: 1; }
        }

        /* All other existing styles remain the same... */
        .app-container {
            display: flex;
            height: 100vh;
        }
		
		/* Full Screen Mode Styles */
        .fullscreen-mode {
            position: fixed;
            top: 0;
            left: 0;
            width: 100vw;
            height: 100vh;
            max-width: none;
            padding: 0;
            z-index: 999;
            background: #0f172a;
        }

        .fullscreen-mode .header {
            margin: 0;
            border-radius: 0;
            border-top: none;
            border-left: none;
            border-right: none;
        }

        .fullscreen-mode .main-content {
            height: calc(100vh - 120px);
            grid-template-columns: 1fr;
            gap: 0;
        }

        .fullscreen-mode .sidebar {
            display: none;
        }

        .fullscreen-mode .main-panel {
            margin: 0;
            border-radius: 0;
            border: none;
            border-top: 1px solid #334155;
        }

        .fullscreen-mode .experiences-grid {
            display: none !important;
        }

        .fullscreen-mode .agenda-container {
            display: flex !important;
        }

        .fullscreen-mode .agenda-content {
            height: calc(100vh - 200px);
        }

        .fullscreen-mode .agenda-grid {
            height: calc(100vh - 200px);
        }

        /* Fullscreen Controls */
        .fullscreen-controls {
            position: fixed;
            top: 20px;
            right: 20px;
            z-index: 1001;
            display: none;
            gap: 12px;
            align-items: center;
        }

        .fullscreen-mode .fullscreen-controls {
            display: flex;
        }

        .fullscreen-exit-btn {
            background: rgba(15, 23, 42, 0.9);
            color: #e2e8f0;
            border: 1px solid #334155;
            padding: 8px 16px;
            border-radius: 8px;
            cursor: pointer;
            font-weight: 600;
            font-size: 0.9rem;
            transition: all 0.3s ease;
            backdrop-filter: blur(8px);
        }

        .fullscreen-exit-btn:hover {
            background: rgba(15, 23, 42, 1);
            border-color: #475569;
        }

        .fullscreen-legend {
            background: rgba(15, 23, 42, 0.9);
            border: 1px solid #334155;
            border-radius: 8px;
            padding: 12px 16px;
            backdrop-filter: blur(8px);
            font-size: 0.85rem;
        }

        .legend-item {
            display: flex;
            align-items: center;
            gap: 8px;
            margin-bottom: 4px;
        }

        .legend-item:last-child {
            margin-bottom: 0;
        }

        .legend-color {
            width: 12px;
            height: 12px;
            border-radius: 3px;
        }

        /* Header */
        .header {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            background: linear-gradient(135deg, #1e293b 0%, #334155 100%);
            border-bottom: 1px solid #334155;
            padding: 16px 24px;
            z-index: 100;
            display: flex;
            justify-content: space-between;
            align-items: center;
            height: 70px;
        }

        .header-left {
            display: flex;
            align-items: center;
            gap: 16px;
        }

        .header-left h1 {
            font-size: 1.5rem;
            font-weight: 700;
            color: #f1f5f9;
        }

        .header-icon {
            width: 48px;
            height: 48px;
            border-radius: 12px;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-size: 1.5rem;
            transition: all 0.3s ease;
        }

        .header-icon.default {
            background: linear-gradient(135deg, #3b82f6, #1d4ed8);
            box-shadow: 0 4px 14px 0 rgba(59, 130, 246, 0.39);
        }

        .header-icon.custom {
            background: transparent;
            box-shadow: none;
        }

        .header-icon img {
            width: 100%;
            height: 100%;
            object-fit: contain;
            border-radius: 12px;
            image-rendering: -webkit-optimize-contrast;
            image-rendering: -moz-crisp-edges;
            image-rendering: crisp-edges;
        }

        .header-right {
            display: flex;
            gap: 12px;
            align-items: center;
        }

        .btn-header {
            background: rgba(59, 130, 246, 0.2);
            color: #3b82f6;
            border: 1px solid rgba(59, 130, 246, 0.3);
            padding: 8px 16px;
            border-radius: 8px;
            cursor: pointer;
            font-weight: 600;
            transition: all 0.3s ease;
        }

        .btn-header:hover {
            background: rgba(59, 130, 246, 0.3);
        }

        /* Sidebar */
        .sidebar {
            width: 350px;
            background: linear-gradient(180deg, #1e293b 0%, #0f172a 100%);
            border-right: 1px solid #334155;
            margin-top: 70px;
            height: calc(100vh - 70px);
            overflow-y: auto;
            display: flex;
            flex-direction: column;
        }

        .sidebar-header {
            padding: 20px;
            border-bottom: 1px solid #334155;
        }

        .sidebar-toggle {
            display: flex;
            gap: 4px;
            background: rgba(15, 23, 42, 0.5);
            border-radius: 8px;
            padding: 4px;
            margin-bottom: 16px;
        }

        .sidebar-toggle button {
            flex: 1;
            padding: 8px 12px;
            background: transparent;
            border: none;
            color: #94a3b8;
            border-radius: 6px;
            cursor: pointer;
            font-weight: 500;
            transition: all 0.2s ease;
        }

        .sidebar-toggle button.active {
            background: rgba(59, 130, 246, 0.2);
            color: #3b82f6;
        }

        .sidebar-panel {
            display: none;
            flex: 1;
            padding: 20px;
            overflow-y: auto;
        }

        .sidebar-panel.active {
            display: block;
        }

        /* Venues Panel */
        .venue-card {
            background: linear-gradient(135deg, #1e293b 0%, #334155 100%);
            border: 1px solid #475569;
            border-radius: 12px;
            padding: 16px;
            margin-bottom: 12px;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .venue-card:hover {
            border-color: #3b82f6;
            transform: translateY(-2px);
        }

        .venue-card.active {
            border-color: #3b82f6;
            background: linear-gradient(135deg, rgba(59, 130, 246, 0.1) 0%, rgba(99, 102, 241, 0.1) 100%);
        }

        .venue-header {
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
            margin-bottom: 8px;
        }

        .venue-header h3 {
            color: #f1f5f9;
            font-size: 1.1rem;
            margin-bottom: 4px;
        }

        .venue-actions {
            display: flex;
            gap: 8px;
            margin-left: auto;
        }

        .btn-icon {
            background: rgba(148, 163, 184, 0.1);
            border: 1px solid rgba(148, 163, 184, 0.2);
            color: #94a3b8;
            padding: 4px 8px;
            border-radius: 6px;
            cursor: pointer;
            font-size: 0.8rem;
            transition: all 0.2s ease;
        }

        .btn-icon:hover {
            background: rgba(148, 163, 184, 0.2);
            color: #e2e8f0;
        }

        .venue-info {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 8px;
            margin-bottom: 12px;
        }

        .venue-detail {
            display: flex;
            align-items: center;
            gap: 6px;
            font-size: 0.85rem;
            color: #94a3b8;
        }

        .venue-detail-icon {
            font-size: 0.8rem;
        }

        /* Experiences Panel */
        .draggable-experience {
            background: linear-gradient(135deg, #1e293b 0%, #334155 100%);
            border: 1px solid #475569;
            border-radius: 8px;
            padding: 12px;
            margin-bottom: 8px;
            cursor: grab;
            transition: all 0.2s ease;
        }

        .draggable-experience:hover {
            border-color: #3b82f6;
            transform: translateY(-1px);
        }

        .draggable-experience.dragging {
            opacity: 0.7;
            transform: rotate(2deg) scale(0.95);
        }

        .experience-drag-info {
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
            margin-bottom: 4px;
        }

        .experience-drag-title {
            font-weight: 600;
            color: #f1f5f9;
            font-size: 0.9rem;
        }

        .experience-drag-type {
            background: rgba(59, 130, 246, 0.2);
            color: #3b82f6;
            padding: 2px 6px;
            border-radius: 4px;
            font-size: 0.7rem;
            font-weight: 600;
        }

        .experience-drag-type.ar {
            background: rgba(139, 92, 246, 0.2);
            color: #8b5cf6;
        }

        .experience-drag-type.mr {
            background: rgba(236, 72, 153, 0.2);
            color: #ec4899;
        }

        .experience-drag-details {
            font-size: 0.75rem;
            color: #94a3b8;
        }

        /* Main Content */
        .main-content {
            flex: 1;
            margin-top: 70px;
            height: calc(100vh - 70px);
            overflow: hidden;
            display: flex;
            flex-direction: column;
        }

        .panel-header {
            background: linear-gradient(135deg, #1e293b 0%, #334155 100%);
            border-bottom: 1px solid #334155;
            padding: 20px 24px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .panel-title {
            font-size: 1.4rem;
            font-weight: 600;
            color: #f1f5f9;
        }

        .view-controls {
            display: flex;
            gap: 12px;
            align-items: center;
        }

        .view-toggle {
            display: flex;
            gap: 4px;
            background: rgba(15, 23, 42, 0.5);
            border-radius: 8px;
            padding: 4px;
        }

        .view-toggle button {
            padding: 8px 16px;
            background: transparent;
            border: none;
            color: #94a3b8;
            border-radius: 6px;
            cursor: pointer;
            font-weight: 500;
            transition: all 0.2s ease;
        }

        .view-toggle button.active {
            background: rgba(59, 130, 246, 0.2);
            color: #3b82f6;
        }

        .btn-primary, .btn-secondary {
            padding: 8px 16px;
            border-radius: 8px;
            cursor: pointer;
            font-weight: 600;
            transition: all 0.3s ease;
            border: none;
        }

        .btn-primary {
            background: linear-gradient(135deg, #3b82f6 0%, #6366f1 100%);
            color: white;
        }

        .btn-secondary {
            background: rgba(148, 163, 184, 0.1);
            color: #94a3b8;
            border: 1px solid rgba(148, 163, 184, 0.2);
        }

        .btn-primary:hover {
            background: linear-gradient(135deg, #2563eb 0%, #4f46e5 100%);
        }

        .btn-secondary:hover {
            background: rgba(148, 163, 184, 0.2);
            color: #e2e8f0;
        }

        /* Content Panels */
        .content-panel {
            flex: 1;
            overflow: hidden;
            display: flex;
            flex-direction: column;
        }

        /* Experiences Grid */
        .experiences-grid {
            padding: 24px;
            overflow-y: auto;
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(350px, 1fr));
            gap: 20px;
        }

        .experience-card {
            background: linear-gradient(135deg, #1e293b 0%, #334155 100%);
            border: 1px solid #475569;
            border-radius: 12px;
            padding: 20px;
            transition: all 0.3s ease;
        }

        .experience-card:hover {
            border-color: #3b82f6;
            transform: translateY(-2px);
        }

        .experience-header {
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
            margin-bottom: 12px;
        }

        .experience-title {
            font-size: 1.2rem;
            font-weight: 600;
            color: #f1f5f9;
            margin-bottom: 4px;
        }

        .experience-type {
            padding: 4px 8px;
            border-radius: 6px;
            font-size: 0.75rem;
            font-weight: 600;
            text-transform: uppercase;
        }

        .type-vr { background: rgba(59, 130, 246, 0.2); color: #3b82f6; }
        .type-ar { background: rgba(139, 92, 246, 0.2); color: #8b5cf6; }
        .type-mr { background: rgba(236, 72, 153, 0.2); color: #ec4899; }
        .type-simulation { background: rgba(34, 197, 94, 0.2); color: #22c55e; }

        .experience-description {
            color: #94a3b8;
            font-size: 0.9rem;
            line-height: 1.5;
            margin-bottom: 16px;
        }

        .requirements {
            margin-bottom: 16px;
        }

        .requirements h4 {
            color: #cbd5e1;
            font-size: 0.8rem;
            font-weight: 600;
            margin-bottom: 8px;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .requirement-tags {
            display: flex;
            flex-wrap: wrap;
            gap: 6px;
        }

        .requirement-tag {
            background: rgba(71, 85, 105, 0.3);
            color: #cbd5e1;
            padding: 4px 8px;
            border-radius: 4px;
            font-size: 0.75rem;
            border: 1px solid rgba(71, 85, 105, 0.5);
        }

        /* Agenda Container */
        .agenda-container {
            display: none;
            flex: 1;
            flex-direction: column;
            overflow: hidden;
        }

        .agenda-container.active {
            display: flex;
        }

        .agenda-controls {
            background: rgba(15, 23, 42, 0.5);
            border-bottom: 1px solid #334155;
            padding: 16px 24px;
            display: flex;
            gap: 16px;
            align-items: center;
        }

        .date-selector {
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .date-selector select {
            background: #374155 !important;
            border: none !important;
            color: #e2e8f0 !important;
            font-size: 0.85rem !important;
            padding: 4px 8px !important;
            border-radius: 4px !important;
            cursor: pointer;
        }

        /* Grid View */
        .agenda-grid {
            display: none;
            flex: 1;
            overflow: auto;
            padding: 24px;
        }

        .agenda-grid.active {
            display: block;
        }

        .grid-container {
            display: grid;
            grid-template-columns: 80px repeat(var(--spaces-count, 3), 1fr);
            grid-template-rows: 50px repeat(var(--time-slots, 20), 40px);
            gap: 1px;
            background: #334155;
            border-radius: 8px;
            overflow: hidden;
            min-height: fit-content;
        }

        .grid-header {
            background: #1e293b;
            color: #f1f5f9;
            font-weight: 600;
            font-size: 0.8rem;
            display: flex;
            align-items: center;
            justify-content: center;
            text-align: center;
            padding: 8px;
        }

        .grid-time {
            background: #1e293b;
            color: #94a3b8;
            font-size: 0.75rem;
            font-weight: 500;
            display: flex;
            align-items: center;
            justify-content: center;
            border-right: 1px solid #475569;
        }

        .grid-cell {
            background: #0f172a;
            position: relative;
            border: 1px solid transparent;
            transition: all 0.2s ease;
            cursor: pointer;
        }

        .grid-cell:hover:not(.occupied) {
            background: rgba(59, 130, 246, 0.1);
            border-color: rgba(59, 130, 246, 0.3);
        }

        .grid-cell.occupied {
            cursor: default;
        }

        .grid-cell.drop-target {
            background: rgba(34, 197, 94, 0.2) !important;
            border: 1px solid #22c55e !important;
        }

        .grid-cell.drop-preview {
            background: rgba(34, 197, 94, 0.1) !important;
            border: 1px dashed #22c55e !important;
        }

        .grid-cell.drop-invalid {
            background: rgba(239, 68, 68, 0.2) !important;
            border: 1px solid #ef4444 !important;
        }

        /* Experience Sessions - Enhanced from 042c */
        .experience-session {
            padding: 6px;
            border-radius: 4px;
            font-size: 0.75rem;
            border: 1px solid rgba(255, 255, 255, 0.1);
        }

        .experience-session.vr {
            background: linear-gradient(135deg, rgba(59, 130, 246, 0.8) 0%, rgba(37, 99, 235, 0.8) 100%);
        }

        .experience-session.ar {
            background: linear-gradient(135deg, rgba(139, 92, 246, 0.8) 0%, rgba(124, 58, 237, 0.8) 100%);
        }

        .experience-session.mr {
            background: linear-gradient(135deg, rgba(236, 72, 153, 0.8) 0%, rgba(219, 39, 119, 0.8) 100%);
        }

        .experience-session.simulation {
            background: linear-gradient(135deg, rgba(34, 197, 94, 0.8) 0%, rgba(21, 128, 61, 0.8) 100%);
        }

        /* Multi-slot experience sessions - Enhanced from 042c */
        .experience-session.multi-slot {
            position: absolute;
            top: 2px;
            left: 2px;
            right: 2px;
            z-index: 10;
            border-radius: 6px;
            padding: 8px;
            overflow: hidden;
            transition: all 0.2s ease;
            cursor: grab;
            border: 2px solid transparent;
        }

        .experience-session.multi-slot:active {
            cursor: grabbing;
        }

        .experience-session.multi-slot:hover {
            transform: translateY(-1px);
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.3);
            z-index: 15;
            border-color: rgba(255, 255, 255, 0.2);
        }

        .experience-session-content {
            display: flex;
            flex-direction: column;
            height: 100%;
            position: relative;
        }

        .session-main-title {
            font-weight: 700;
            font-size: 0.9rem;
            line-height: 1.1;
            margin-bottom: 4px;
            padding-right: 50px; /* Space for action icons */
        }

        .session-meta {
            font-size: 0.75rem;
            opacity: 0.8;
            line-height: 1.2;
            flex: 1;
        }

        /* Session action icons - Enhanced from 042c */
        .session-actions {
            position: absolute;
            top: 4px;
            right: 4px;
            display: flex;
            gap: 4px;
            opacity: 0;
            transition: all 0.2s ease;
            z-index: 20;
        }

        .experience-session.multi-slot:hover .session-actions {
            opacity: 1;
        }

        .session-action-btn {
            width: 22px;
            height: 22px;
            border-radius: 4px;
            background: rgba(0, 0, 0, 0.7);
            border: 1px solid rgba(255, 255, 255, 0.3);
            color: white;
            font-size: 0.75rem;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            transition: all 0.2s ease;
            backdrop-filter: blur(4px);
            user-select: none;
        }

        .session-action-btn:hover {
            background: rgba(0, 0, 0, 0.9);
            border-color: rgba(255, 255, 255, 0.5);
            transform: scale(1.1);
        }

        .session-action-btn.info:hover {
            background: rgba(59, 130, 246, 0.8);
        }

        .session-action-btn.delete:hover {
            background: rgba(239, 68, 68, 0.8);
        }

        /* Bottom right resize handle - Enhanced from 042c */
        .session-resize-handle {
            position: absolute;
            bottom: 2px;
            right: 2px;
            width: 12px;
            height: 12px;
            background: rgba(255, 255, 255, 0.3);
            border: 1px solid rgba(255, 255, 255, 0.5);
            border-radius: 2px;
            cursor: ns-resize;
            opacity: 0;
            transition: all 0.2s ease;
            z-index: 20;
        }

        .session-resize-handle::before {
            content: '';
            position: absolute;
            bottom: 1px;
            right: 1px;
            width: 6px;
            height: 6px;
            background: linear-gradient(-45deg, 
                transparent 0%, transparent 30%, 
                rgba(255,255,255,0.6) 30%, rgba(255,255,255,0.6) 35%,
                transparent 35%, transparent 65%,
                rgba(255,255,255,0.6) 65%, rgba(255,255,255,0.6) 70%,
                transparent 70%);
        }

        .experience-session.multi-slot:hover .session-resize-handle {
            opacity: 1;
        }

        .session-resize-handle:hover {
            background: rgba(255, 255, 255, 0.5);
            border-color: rgba(255, 255, 255, 0.8);
            transform: scale(1.2);
        }

        /* Dragging states for sessions - Enhanced from 042c */
        .experience-session.dragging-move {
            opacity: 0.7;
            transform: rotate(2deg) scale(0.95);
            z-index: 30;
        }

        .experience-session.dragging-resize {
            z-index: 25;
        }

        /* Duplication preview */
        .grid-cell.duplicate-preview {
            background: rgba(34, 197, 94, 0.15) !important;
            border: 1px dashed #22c55e !important;
        }

        .grid-cell.duplicate-invalid {
            background: rgba(239, 68, 68, 0.15) !important;
            border: 1px dashed #ef4444 !important;
        }

        /* Prevent text selection during dragging */
        .experience-session.multi-slot * {
            user-select: none;
        }

        /* List View */
        .agenda-list {
            display: none;
            flex: 1;
            overflow-y: auto;
            padding: 24px;
        }

        .agenda-list.active {
            display: block;
        }

        .day-section {
            margin-bottom: 32px;
            background: rgba(30, 41, 59, 0.3);
            border-radius: 12px;
            overflow: hidden;
        }

        .day-header {
            background: linear-gradient(135deg, #1e293b 0%, #334155 100%);
            padding: 16px 20px;
            border-bottom: 1px solid #475569;
        }

        .day-title {
            font-size: 1.2rem;
            font-weight: 600;
            color: #f1f5f9;
            margin-bottom: 4px;
        }

        .day-info {
            font-size: 0.9rem;
            color: #94a3b8;
        }

        .time-slot {
            display: flex;
            border-bottom: 1px solid rgba(71, 85, 105, 0.3);
            min-height: 60px;
        }

        .time-slot:last-child {
            border-bottom: none;
        }

        .time-label {
            width: 100px;
            padding: 16px;
            font-size: 0.85rem;
            font-weight: 600;
            color: #94a3b8;
            background: rgba(15, 23, 42, 0.5);
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .experiences-in-slot {
            flex: 1;
            padding: 12px 16px;
            display: flex;
            flex-direction: column;
            gap: 8px;
        }

        .empty-slot {
            color: #64748b;
            font-style: italic;
            font-size: 0.85rem;
            padding: 8px 0;
        }
/* Fullscreen Modal */
        .fullscreen-modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100vw;
            height: 100vh;
            background: #0f172a;
            z-index: 2000;
            overflow: hidden;
        }

        .fullscreen-modal.active {
            display: flex;
            flex-direction: column;
        }

        .fullscreen-header {
            background: linear-gradient(135deg, #1e293b 0%, #334155 100%);
            border-bottom: 1px solid #334155;
            padding: 16px 24px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            flex-shrink: 0;
        }

        .fullscreen-title {
            color: #f1f5f9;
            font-size: 1.5rem;
            font-weight: 600;
        }

        .fullscreen-controls {
            display: flex;
            gap: 12px;
            align-items: center;
        }

        .fullscreen-close {
            background: rgba(239, 68, 68, 0.2);
            color: #ef4444;
            border: 1px solid rgba(239, 68, 68, 0.3);
            padding: 8px 16px;
            border-radius: 8px;
            cursor: pointer;
            font-weight: 600;
            transition: all 0.3s ease;
        }

        .fullscreen-close:hover {
            background: rgba(239, 68, 68, 0.3);
        }

        .fullscreen-content {
            flex: 1;
            overflow: hidden;
            padding: 24px;
            display: flex;
            flex-direction: column;
        }

        .fullscreen-agenda-content {
            flex: 1;
            overflow: hidden;
            display: flex;
            flex-direction: column;
        }

        /* Modals */
        .modal {
            display: none;
            position: fixed;
            z-index: 1000;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.7);
            backdrop-filter: blur(4px);
        }

        .modal-content {
            background: linear-gradient(135deg, #1e293b 0%, #334155 100%);
            margin: 5% auto;
            padding: 0;
            border-radius: 12px;
            width: 90%;
            max-width: 600px;
            max-height: 80vh;
            overflow: hidden;
            border: 1px solid #475569;
        }

        .modal-header {
            background: rgba(15, 23, 42, 0.5);
            padding: 20px 24px;
            border-bottom: 1px solid #475569;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .modal-title {
            font-size: 1.3rem;
            font-weight: 600;
            color: #f1f5f9;
        }

        .close {
            color: #94a3b8;
            font-size: 28px;
            font-weight: bold;
            cursor: pointer;
            transition: color 0.3s ease;
        }

        .close:hover {
            color: #e2e8f0;
        }

        .modal-body {
            padding: 24px;
            max-height: 60vh;
            overflow-y: auto;
        }

        .form-group {
            margin-bottom: 20px;
        }

        .form-group label {
            display: block;
            margin-bottom: 6px;
            color: #cbd5e1;
            font-weight: 500;
            font-size: 0.9rem;
        }

        .form-group input,
        .form-group select,
        .form-group textarea {
            width: 100%;
            padding: 10px 12px;
            background: rgba(15, 23, 42, 0.5);
            border: 1px solid #475569;
            border-radius: 8px;
            color: #e2e8f0;
            font-size: 0.9rem;
            transition: all 0.3s ease;
        }

        .form-group input:focus,
        .form-group select:focus,
        .form-group textarea:focus {
            outline: none;
            border-color: #3b82f6;
            background: rgba(15, 23, 42, 0.8);
        }

        .form-group textarea {
            resize: vertical;
            min-height: 80px;
        }

        .form-actions {
            display: flex;
            gap: 12px;
            justify-content: flex-end;
            padding: 20px 24px;
            background: rgba(15, 23, 42, 0.3);
            border-top: 1px solid #475569;
        }

        .btn-cancel {
            background: rgba(148, 163, 184, 0.1);
            color: #94a3b8;
            border: 1px solid rgba(148, 163, 184, 0.2);
            padding: 10px 20px;
            border-radius: 8px;
            cursor: pointer;
            font-weight: 600;
            transition: all 0.3s ease;
        }

        .btn-cancel:hover {
            background: rgba(148, 163, 184, 0.2);
            color: #e2e8f0;
        }

        .btn-save {
            background: linear-gradient(135deg, #3b82f6 0%, #6366f1 100%);
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 8px;
            cursor: pointer;
            font-weight: 600;
            transition: all 0.3s ease;
        }

        .btn-save:hover {
            background: linear-gradient(135deg, #2563eb 0%, #4f46e5 100%);
        }

        .form-row {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
        }

        /* Multi-select */
        .multi-select {
            border: 1px solid #475569;
            border-radius: 8px;
            background: rgba(15, 23, 42, 0.5);
            max-height: 120px;
            overflow-y: auto;
            padding: 8px;
        }

        .multi-select-item {
            display: flex;
            align-items: center;
            gap: 8px;
            padding: 6px;
            border-radius: 4px;
            transition: background 0.2s ease;
        }

        .multi-select-item:hover {
            background: rgba(59, 130, 246, 0.1);
        }

        .multi-select-item input[type="checkbox"] {
            width: auto;
            margin: 0;
        }

        .multi-select-item label {
            margin: 0;
            cursor: pointer;
            font-size: 0.85rem;
        }

        /* Quick Schedule Popup */
        .quick-schedule-popup {
            position: fixed;
            background: linear-gradient(135deg, #1e293b 0%, #334155 100%);
            border: 1px solid #475569;
            border-radius: 12px;
            padding: 20px;
            z-index: 1001;
            min-width: 300px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.5);
        }

        .quick-schedule-header {
            font-size: 1.1rem;
            font-weight: 600;
            color: #f1f5f9;
            margin-bottom: 12px;
        }

        .quick-schedule-info {
            color: #94a3b8;
            font-size: 0.9rem;
            line-height: 1.4;
            margin-bottom: 16px;
        }

        .quick-schedule-actions {
            display: flex;
            gap: 8px;
            justify-content: flex-end;
        }

        .btn-quick {
            padding: 8px 16px;
            border-radius: 6px;
            cursor: pointer;
            font-weight: 600;
            font-size: 0.85rem;
            transition: all 0.2s ease;
            border: none;
        }

        .btn-quick-secondary {
            background: rgba(148, 163, 184, 0.1);
            color: #94a3b8;
            border: 1px solid rgba(148, 163, 184, 0.2);
        }

        .btn-quick-primary {
            background: linear-gradient(135deg, #3b82f6 0%, #6366f1 100%);
            color: white;
        }

        .btn-quick-secondary:hover {
            background: rgba(148, 163, 184, 0.2);
            color: #e2e8f0;
        }

        .btn-quick-primary:hover {
            background: linear-gradient(135deg, #2563eb 0%, #4f46e5 100%);
        }

        /* Settings specific styles */
        .settings-section {
            margin-bottom: 32px;
        }

        .settings-section h3 {
            color: #f1f5f9;
            font-size: 1.1rem;
            font-weight: 600;
            margin-bottom: 16px;
            padding-bottom: 8px;
            border-bottom: 1px solid #475569;
        }

        /* Logo styles */
        .logo-upload-area {
            display: flex;
            align-items: center;
            gap: 12px;
            padding: 12px;
            border: 1px solid #475569;
            border-radius: 8px;
            background: rgba(15, 23, 42, 0.5);
        }

        .logo-preview {
            width: 48px;
            height: 48px;
            border-radius: 12px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.5rem;
            color: white;
            overflow: hidden;
        }

        .logo-preview.default {
            background: linear-gradient(135deg, #3b82f6, #1d4ed8);
        }

        .logo-preview.custom {
            background: transparent;
        }

        .logo-preview img {
            width: 100%;
            height: 100%;
            object-fit: contain;
            border-radius: 12px;
        }

        .file-input {
            display: none;
        }

        .file-label {
            background: rgba(59, 130, 246, 0.2);
            color: #3b82f6;
            border: 1px solid rgba(59, 130, 246, 0.3);
            padding: 8px 16px;
            border-radius: 8px;
            cursor: pointer;
            font-size: 0.9rem;
            font-weight: 600;
            transition: all 0.3s ease;
        }

        .file-label:hover {
            background: rgba(59, 130, 246, 0.3);
        }

        .remove-logo-btn {
            background: rgba(239, 68, 68, 0.2);
            color: #ef4444;
            border: 1px solid rgba(239, 68, 68, 0.3);
            padding: 8px 16px;
            border-radius: 8px;
            cursor: pointer;
            font-size: 0.9rem;
            font-weight: 600;
            transition: all 0.3s ease;
        }

        .remove-logo-btn:hover {
            background: rgba(239, 68, 68, 0.3);
        }

        /* Collapsible sections */
        .collapsible-section {
            border: 1px solid #475569;
            border-radius: 12px;
            margin-bottom: 20px;
            overflow: hidden;
            transition: all 0.3s ease;
        }

        .collapsible-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 16px 20px;
            background: rgba(15, 23, 42, 0.5);
            cursor: pointer;
            transition: all 0.3s ease;
            user-select: none;
        }

        .collapsible-header:hover {
            background: rgba(15, 23, 42, 0.7);
        }

        .collapsible-header h3 {
            color: #f1f5f9;
            font-size: 1rem;
            font-weight: 600;
            margin: 0;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .collapsible-arrow {
            color: #94a3b8;
            font-size: 1.2rem;
            transition: transform 0.3s ease;
            transform: rotate(0deg);
        }

        .collapsible-content {
            max-height: 0;
            overflow: hidden;
            transition: max-height 0.3s ease;
        }

        .collapsible-inner {
            padding: 20px;
        }

        /* Options list */
        .option-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 8px 0;
            border-bottom: 1px solid #475569;
        }

        .option-item:last-child {
            border-bottom: none;
        }

        .option-text {
            color: #e2e8f0;
            flex: 1;
        }

        .option-remove {
            background: rgba(239, 68, 68, 0.2);
            color: #ef4444;
            border: 1px solid rgba(239, 68, 68, 0.3);
            padding: 4px 8px;
            border-radius: 4px;
            cursor: pointer;
            font-size: 0.8rem;
            transition: all 0.3s ease;
        }

        .option-remove:hover {
            background: rgba(239, 68, 68, 0.3);
        }

        .add-option-row {
            display: flex;
            gap: 8px;
            margin-bottom: 12px;
        }

        .add-option-input {
            flex: 1;
        }

        .add-option-btn {
            background: rgba(34, 197, 94, 0.2);
            color: #22c55e;
            border: 1px solid rgba(34, 197, 94, 0.3);
            padding: 8px 16px;
            border-radius: 8px;
            cursor: pointer;
            font-weight: 600;
            transition: all 0.3s ease;
        }

        .add-option-btn:hover {
            background: rgba(34, 197, 94, 0.3);
        }

        .options-list {
            max-height: 200px;
            overflow-y: auto;
            border: 1px solid #475569;
            border-radius: 8px;
            padding: 12px;
            background: rgba(15, 23, 42, 0.5);
        }

        /* Daily schedule styles */
        .daily-schedule-item {
            display: flex;
            align-items: center;
            gap: 12px;
            padding: 12px;
            margin-bottom: 8px;
            background: rgba(71, 85, 105, 0.3);
            border: 1px solid #475569;
            border-radius: 8px;
            transition: all 0.3s ease;
        }

        .daily-schedule-item:hover {
            background: rgba(59, 130, 246, 0.1);
            border-color: #3b82f6;
        }

        .schedule-date {
            min-width: 100px;
            color: #f1f5f9;
            font-weight: 600;
            font-size: 0.9rem;
        }

        .schedule-times {
            display: flex;
            gap: 8px;
            align-items: center;
            flex: 1;
        }

        .schedule-time-input {
            width: 120px !important;
            padding: 8px 12px !important;
            font-size: 0.85rem !important;
            background: #1e293b !important;
            border: 1px solid #475569 !important;
            border-radius: 4px !important;
        }

        .schedule-toggle {
            display: flex;
            align-items: center;
            gap: 8px;
            color: #cbd5e1;
            font-size: 0.85rem;
        }

        .schedule-toggle input[type="checkbox"] {
            width: auto !important;
            margin: 0 !important;
        }

        /* Venue Spaces */
        .spaces-section {
            margin-top: 16px;
            padding-top: 16px;
            border-top: 1px solid #475569;
        }

        .spaces-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 12px;
        }

        .spaces-header label {
            color: #cbd5e1;
            font-weight: 600;
            font-size: 0.9rem;
        }

        .add-space-btn {
            background: rgba(34, 197, 94, 0.2);
            color: #22c55e;
            border: 1px solid rgba(34, 197, 94, 0.3);
            border-radius: 4px;
            padding: 4px 8px;
            font-size: 0.75rem;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .add-space-btn:hover {
            background: rgba(34, 197, 94, 0.3);
        }

        .space-form {
            background: rgba(71, 85, 105, 0.3);
            border: 1px solid #475569;
            border-radius: 8px;
            padding: 16px;
            margin-bottom: 16px;
        }

        .space-form-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 16px;
        }

        .space-form-title {
            color: #f1f5f9;
            font-size: 1.1rem;
            font-weight: 600;
        }

        .spaces-list {
            max-height: 200px;
            overflow-y: auto;
        }

        .space-item {
            background: rgba(71, 85, 105, 0.3);
            border: 1px solid #475569;
            border-radius: 6px;
            padding: 8px;
            margin-bottom: 6px;
            transition: all 0.3s ease;
        }

        .space-item:hover {
            background: rgba(59, 130, 246, 0.1);
            border-color: #3b82f6;
        }

        .space-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 4px;
        }

        .space-name {
            color: #f1f5f9;
            font-weight: 600;
            font-size: 0.85rem;
        }

        .space-info {
            color: #94a3b8;
            font-size: 0.75rem;
            margin-bottom: 2px;
        }

        .space-description {
            color: #64748b;
            font-size: 0.7rem;
            font-style: italic;
            line-height: 1.2;
        }

        .space-actions {
            display: flex;
            gap: 4px;
            opacity: 0;
            transition: opacity 0.3s ease;
        }

        .space-item:hover .space-actions {
            opacity: 1;
        }

        .space-btn {
            background: rgba(148, 163, 184, 0.2);
            border: none;
            border-radius: 4px;
            width: 20px;
            height: 20px;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            transition: all 0.3s ease;
            font-size: 0.7rem;
        }

        .space-btn:hover {
            background: rgba(59, 130, 246, 0.3);
        }

        .space-btn.delete:hover {
            background: rgba(239, 68, 68, 0.3);
        }

        /* Experience actions */
        .experience-actions {
            display: flex;
            gap: 8px;
        }

        .btn-edit {
            background: rgba(59, 130, 246, 0.2);
            color: #3b82f6;
            border: 1px solid rgba(59, 130, 246, 0.3);
            padding: 6px 12px;
            border-radius: 6px;
            cursor: pointer;
            font-size: 0.85rem;
            font-weight: 600;
            transition: all 0.3s ease;
        }

        .btn-edit:hover {
            background: rgba(59, 130, 246, 0.3);
        }

        .btn-delete {
            background: rgba(239, 68, 68, 0.2);
            color: #ef4444;
            border: 1px solid rgba(239, 68, 68, 0.3);
            padding: 6px 12px;
            border-radius: 6px;
            cursor: pointer;
            font-size: 0.85rem;
            font-weight: 600;
            transition: all 0.3s ease;
        }

        .btn-delete:hover {
            background: rgba(239, 68, 68, 0.3);
        }

        /* Drag preview element */
        .drag-preview-element {
            position: fixed;
            pointer-events: none;
            z-index: 1000;
            transform: rotate(-2deg);
            opacity: 0.9;
            border: 2px solid rgba(255, 255, 255, 0.5);
            border-radius: 6px;
            padding: 8px;
            background: inherit;
        }

        /* Session drag instruction */
        .drag-instruction {
            position: fixed;
            top: 20px;
            left: 50%;
            transform: translateX(-50%);
            background: #3b82f6;
            color: white;
            padding: 12px 20px;
            border-radius: 8px;
            z-index: 1002;
            font-weight: 600;
        }

        /* Drop zone feedback */
        .grid-cell.drop-zone {
            transition: all 0.2s ease;
        }

        @media (max-width: 768px) {
            .app-container {
                flex-direction: column;
            }

            .sidebar {
                width: 100%;
                height: 300px;
            }

            .main-content {
                margin-top: 370px;
                height: calc(100vh - 370px);
            }

            .experiences-grid {
                grid-template-columns: 1fr;
            }

            .form-row {
                grid-template-columns: 1fr;
            }
            
        @media (max-height: 700px) {
            .password-modal-content {
                margin: 1% auto;
                padding: 20px;
                max-height: 98vh;
            }
            
            .password-display {
                margin-bottom: 16px;
                font-size: 1.3rem;
                min-height: 50px;
            }
            
            .password-keypad {
                gap: 8px;
                margin-bottom: 16px;
            }
            
            .keypad-btn {
                padding: 15px;
                font-size: 1.1rem;
            }
        }
        }
    </style>
</head>
<body>
    <!-- Project Selection Modal -->
    <div id="projectModal" class="project-modal">
        <div class="project-modal-content">
            <div class="project-modal-header">
                <h2 class="project-modal-title">Select Project</h2>
                <button class="btn-icon" onclick="cancelProjectSelection()" style="font-size: 1.2rem;">✕</button>
            </div>
            <div class="project-modal-body">
                <div class="project-list" id="projectList">
                    <!-- Projects will be populated here -->
                </div>
                <div class="new-project-section">
                    <div class="new-project-buttons">
                        <button class="new-project-btn" onclick="createNewProject(false)">
                            <span>+</span>
                            <span>Create New Blank Project</span>
                        </button>
                        <button class="new-project-btn template" onclick="createNewProject(true)">
                            <span>📋</span>
                            <span>Create Project from Template</span>
                        </button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Password Entry Modal -->
    <div id="passwordModal" class="password-modal">
        <div class="password-modal-content">
            <h3 class="password-title">Enter Project Password</h3>
            <p class="password-subtitle">This project requires a 6-digit password</p>
            
            <div class="password-display" id="passwordDisplay">------</div>
            
            <div class="password-keypad">
                <button class="keypad-btn" onclick="addPasswordDigit('1')">1</button>
                <button class="keypad-btn" onclick="addPasswordDigit('2')">2</button>
                <button class="keypad-btn" onclick="addPasswordDigit('3')">3</button>
                <button class="keypad-btn" onclick="addPasswordDigit('4')">4</button>
                <button class="keypad-btn" onclick="addPasswordDigit('5')">5</button>
                <button class="keypad-btn" onclick="addPasswordDigit('6')">6</button>
                <button class="keypad-btn" onclick="addPasswordDigit('7')">7</button>
                <button class="keypad-btn" onclick="addPasswordDigit('8')">8</button>
                <button class="keypad-btn" onclick="addPasswordDigit('9')">9</button>
                <button class="keypad-btn clear" onclick="clearPassword()">Clear</button>
                <button class="keypad-btn" onclick="addPasswordDigit('0')">0</button>
                <button class="keypad-btn submit" onclick="submitPassword()">Enter</button>
            </div>
            
            <div class="password-actions">
                <button class="password-cancel" onclick="cancelPasswordEntry()">Cancel</button>
            </div>
        </div>
    </div>

    <!-- Sync Indicator -->
    <div id="syncIndicator" class="sync-indicator">
        Syncing changes...
    </div>

    <div class="app-container">
        <!-- Header -->
        <div class="header">
            <div class="header-left">
                <div class="header-icon default" id="headerIcon">🎮</div>
                <h1 id="appTitle">4E Event Planner</h1>
            </div>
            <div class="header-right">
                <!-- Connection Status Indicator -->
				<div id="connectionStatus" class="connection-status disconnected">
					<div class="offline-indicator"></div>
					<span>Offline Mode</span>
				</div>
				<button class="btn-header" onclick="changeProject()">🔄 Switch Project</button>
                <button class="btn-header" onclick="openSettingsModal()">⚙️ Settings</button>
                <button class="btn-header" onclick="exportPlan()">📤 Export</button>
                <button class="btn-header" onclick="importData()">📥 Import</button>
            </div>
        </div>

        <!-- [Rest of your existing HTML structure remains exactly the same] -->
        <!-- Sidebar -->
        <div class="sidebar">
            <div class="sidebar-header">
                <div class="sidebar-toggle">
                    <button id="venuesToggle" onclick="setSidebarMode('venues')" class="active">Venues</button>
                    <button id="experiencesToggle" onclick="setSidebarMode('experiences')">Experiences</button>
                </div>
                <button class="btn-primary" onclick="sidebarMode === 'venues' ? openVenueModal() : openExperienceModal()">
                    + Add <span id="addButtonText">Venue</span>
                </button>
            </div>

            <!-- Venues Panel -->
            <div class="sidebar-panel active" id="venues-panel">
                <div id="venues-list">
                    <!-- Venues will be populated here -->
                </div>
            </div>

            <!-- Experiences Panel -->
            <div class="sidebar-panel" id="experiences-panel">
                <div id="sidebar-draggable-experiences">
                    <!-- Draggable experiences will be populated here -->
                </div>
            </div>
        </div>

        <!-- Main Content -->
        <div class="main-content">
            <div class="panel-header">
                <h2 class="panel-title" id="panel-title">XR Experience Catalog</h2>
                <div class="view-controls">
                    <div class="view-toggle">
                        <button onclick="switchToExperiencesView()" id="experiencesViewBtn" class="active">Experiences</button>
                        <button onclick="switchToAgendaView()" id="agendaViewBtn">Agenda</button>
                    </div>
                </div>
            </div>

            <div class="content-panel">
                <!-- Experiences Grid -->
                <div class="experiences-grid" id="experiences-grid">
                    <!-- Experience cards will be populated here -->
                </div>

                <!-- Agenda Container -->
                <div class="agenda-container" id="agenda-container">
                    <div class="agenda-controls">
                        <button class="btn-secondary" onclick="openFullscreenAgenda()" title="Fullscreen View">🖥️ Fullscreen</button>
                        <div class="view-toggle">
                            <button onclick="setAgendaViewMode('grid')" id="gridViewBtn" class="active">Grid</button>
                            <button onclick="setAgendaViewMode('list')" id="listViewBtn">List</button>
                        </div>
                        <div class="view-toggle">
                            <button onclick="setAgendaTimeMode('multiday')" id="multidayBtn" class="active">Multi-Day</button>
                            <button onclick="setAgendaTimeMode('single')" id="singledayBtn">Single Day</button>
                        </div>
                        <div class="date-selector" id="dateSelector" style="display: none;">
                            <span style="color: #cbd5e1; font-size: 0.85rem;">Day:</span>
                            <select id="daySelect" onchange="setSelectedAgendaDate(this.value)">
                                <!-- Days will be populated here -->
                            </select>
                        </div>
                        <button class="btn-primary" onclick="openScheduleModal()">+ Schedule</button>
                    </div>

                    <!-- Grid View -->
                    <div class="agenda-grid active" id="agenda-grid">
                        <div class="grid-container" id="grid-container">
                            <!-- Grid will be populated here -->
                        </div>
                    </div>
                    
                    <!-- List View -->
                    <div class="agenda-list" id="agenda-list">
                        <!-- List will be populated here -->
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Fullscreen Agenda Modal -->
    <div id="fullscreenModal" class="fullscreen-modal">
        <div class="fullscreen-header">
            <h2 class="fullscreen-title" id="fullscreenTitle">Event Schedule - Fullscreen View</h2>
            <div class="fullscreen-controls">
                <div class="view-toggle">
                    <button onclick="setFullscreenViewMode('grid')" id="fullscreenGridBtn" class="active">Grid</button>
                    <button onclick="setFullscreenViewMode('list')" id="fullscreenListBtn">List</button>
                </div>
                <div class="view-toggle">
                    <button onclick="setFullscreenTimeMode('multiday')" id="fullscreenMultidayBtn" class="active">Multi-Day</button>
                    <button onclick="setFullscreenTimeMode('single')" id="fullscreenSingledayBtn">Single Day</button>
                </div>
                <div class="date-selector" id="fullscreenDateSelector" style="display: none;">
                    <span style="color: #cbd5e1; font-size: 0.85rem;">Day:</span>
                    <select id="fullscreenDaySelect" onchange="setFullscreenSelectedDate(this.value)">
                        <!-- Days will be populated here -->
                    </select>
                </div>
                <button class="fullscreen-close" onclick="closeFullscreenAgenda()">✕ Close</button>
            </div>
        </div>
        <div class="fullscreen-content">
            <div class="fullscreen-agenda-content">
                <!-- Fullscreen Grid View -->
                <div class="agenda-grid active" id="fullscreen-agenda-grid">
                    <div class="grid-container" id="fullscreen-grid-container">
                        <!-- Grid will be populated here -->
                    </div>
                </div>
                
                <!-- Fullscreen List View -->
                <div class="agenda-list" id="fullscreen-agenda-list">
                    <!-- List will be populated here -->
                </div>
            </div>
        </div>
    </div>

    <!-- Schedule Modal -->
    <div id="scheduleModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2 class="modal-title">Schedule Experience</h2>
                <span class="close" onclick="closeScheduleModal()">&times;</span>
            </div>
            <div class="modal-body">
                <form id="scheduleForm">
                    <div class="form-group">
                        <label for="scheduleExperience">Experience</label>
                        <select id="scheduleExperience" required onchange="updateScheduleEndTime()">
                            <!-- Experiences will be populated here -->
                        </select>
                    </div>
                    <div class="form-row">
                        <div class="form-group">
                            <label for="scheduleVenue">Venue</label>
                            <select id="scheduleVenue" required onchange="populateScheduleSpaces()">
                                <!-- Venues will be populated here -->
                            </select>
                        </div>
                        <div class="form-group">
                            <label for="scheduleSpace">Space</label>
                            <select id="scheduleSpace" required>
                                <!-- Spaces will be populated here -->
                            </select>
                        </div>
                    </div>
                    <div class="form-row">
                        <div class="form-group">
                            <label for="scheduleDate">Date</label>
                            <select id="scheduleDate" required>
                                <!-- Dates will be populated here -->
                            </select>
                        </div>
                        <div class="form-group">
                            <label for="maxCapacity">Max Participants</label>
                            <input type="number" id="maxCapacity" value="20" min="1" max="100" required>
                        </div>
                    </div>
                    <div class="form-row">
                        <div class="form-group">
                            <label for="scheduleStartTime">Start Time</label>
                            <input type="time" id="scheduleStartTime" required onchange="updateScheduleEndTime()">
                        </div>
                        <div class="form-group">
                            <label for="scheduleEndTime">End Time</label>
                            <input type="time" id="scheduleEndTime" readonly>
                        </div>
                    </div>
                    <div class="form-group">
                        <label for="bufferTime">Buffer Time (minutes)</label>
                        <input type="number" id="bufferTime" value="5" min="0" max="60" onchange="updateScheduleEndTime()">
                    </div>
                    <div class="form-group">
                        <label for="sessionNotes">Session Notes</label>
                        <textarea id="sessionNotes" placeholder="Optional notes for this session..."></textarea>
                    </div>
                </form>
            </div>
            <div class="form-actions">
                <button type="button" class="btn-cancel" onclick="closeScheduleModal()">Cancel</button>
                <button type="submit" class="btn-save" onclick="document.getElementById('scheduleForm').dispatchEvent(new Event('submit'))">Schedule Session</button>
            </div>
        </div>
    </div>

    <!-- Settings Modal -->
    <div id="settingsModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2 class="modal-title">Application Settings</h2>
                <span class="close" onclick="closeSettingsModal()">&times;</span>
            </div>
            <div class="modal-body">
                <div class="form-group">
                    <label>Application Title</label>
                    <input type="text" id="appTitleInput" placeholder="Enter application title...">
                </div>

                <div class="form-group">
                    <label>Application Logo</label>
                    <div class="logo-upload-area">
                        <div class="logo-preview default" id="logoPreview">🎮</div>
                        <div style="flex: 1;">
                            <div style="color: #e2e8f0; font-size: 0.9rem; margin-bottom: 4px;" id="logoStatus">Default icon</div>
                            <div style="color: #94a3b8; font-size: 0.8rem;">Recommended: High resolution PNG/SVG</div>
                        </div>
                        <input type="file" id="logoUpload" class="file-input" accept="image/*" onchange="handleLogoUpload(event)">
                        <label for="logoUpload" class="file-label">Choose Logo</label>
                        <button type="button" class="remove-logo-btn" onclick="removeLogo()">Remove</button>
                    </div>
                </div>

                <div class="form-group">
                    <label>Default Experience Duration (minutes)</label>
                    <input type="number" id="defaultDuration" min="1" max="180" value="30">
                </div>

                <!-- Event Configuration Section -->
                <div class="settings-section">
                    <h3>Event Configuration</h3>
                    
                    <div class="form-group">
                        <label>Event Name</label>
                        <input type="text" id="eventName" placeholder="Enter event name...">
                    </div>

                    <div class="form-row">
                        <div class="form-group">
                            <label>Start Date</label>
                            <input type="date" id="eventStartDate">
                        </div>
                        <div class="form-group">
                            <label>End Date</label>
                            <input type="date" id="eventEndDate">
                        </div>
                    </div>

                    <div class="form-row">
                        <div class="form-group">
                            <label>Time Zone</label>
                            <select id="eventTimeZone">
                                <option value="UTC">UTC</option>
                                <option value="America/New_York">Eastern Time</option>
                                <option value="America/Chicago">Central Time</option>
                                <option value="America/Denver">Mountain Time</option>
                                <option value="America/Los_Angeles">Pacific Time</option>
                                <option value="Europe/London">GMT</option>
                                <option value="Europe/Paris">Central European Time</option>
                                <option value="Asia/Tokyo">Japan Time</option>
                                <option value="Asia/Shanghai">China Time</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label>Default Buffer Time (minutes)</label>
                            <input type="number" id="defaultBufferTime" min="0" max="60" value="5">
                        </div>
                    </div>

                    <div class="form-group">
                        <label>Daily Operating Hours</label>
                        <div id="dailySchedulesList" style="background: rgba(15, 23, 42, 0.5); border: 1px solid #475569; border-radius: 8px; padding: 16px;">
                            <!-- Daily schedules will be populated here -->
                        </div>
                    </div>
                </div>

                <div class="settings-section">
                    <h3>Configuration Options</h3>
                    
                    <div class="collapsible-section" id="hardwareSection">
                        <div class="collapsible-header" onclick="toggleCollapsible('hardwareSection')">
                            <h3>Hardware Options</h3>
                            <span class="collapsible-arrow">▼</span>
                        </div>
                        <div class="collapsible-content">
                            <div class="collapsible-inner">
                                <div class="add-option-row">
                                    <input type="text" id="newHardware" class="add-option-input" placeholder="Add new hardware option...">
                                    <button type="button" class="add-option-btn" onclick="addHardwareOption()">Add</button>
                                </div>
                                <div class="options-list" id="hardwareList">
                                    <!-- Hardware options will be populated here -->
                                </div>
                            </div>
                        </div>
                    </div>

                    <div class="collapsible-section" id="softwareSection">
                        <div class="collapsible-header" onclick="toggleCollapsible('softwareSection')">
                            <h3>Software Options</h3>
                            <span class="collapsible-arrow">▼</span>
                        </div>
                        <div class="collapsible-content">
                            <div class="collapsible-inner">
                                <div class="add-option-row">
                                    <input type="text" id="newSoftware" class="add-option-input" placeholder="Add new software option...">
                                    <button type="button" class="add-option-btn" onclick="addSoftwareOption()">Add</button>
                                </div>
                                <div class="options-list" id="softwareList">
                                    <!-- Software options will be populated here -->
                                </div>
                            </div>
                        </div>
                    </div>

                    <div class="collapsible-section" id="spaceSection">
                        <div class="collapsible-header" onclick="toggleCollapsible('spaceSection')">
                            <h3>Space Options</h3>
                            <span class="collapsible-arrow">▼</span>
                        </div>
                        <div class="collapsible-content">
                            <div class="collapsible-inner">
                                <div class="add-option-row">
                                    <input type="text" id="newSpace" class="add-option-input" placeholder="Add new space option...">
                                    <button type="button" class="add-option-btn" onclick="addSpaceOption()">Add</button>
                                </div>
                                <div class="options-list" id="spaceList">
                                    <!-- Space options will be populated here -->
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Admin Section -->
                <div class="admin-section">
                    <div class="admin-header">
                        <h3 class="admin-title">🔐 Administrator Tools</h3>
                        <button class="admin-btn" onclick="toggleAdminSection()">Access Admin</button>
                    </div>
                    <div class="admin-content" id="adminContent">
                        <div class="form-group">
                            <label>Admin Password</label>
                            <input type="password" id="adminPassword" placeholder="Enter admin password...">
                            <button class="btn-primary" style="margin-top: 12px;" onclick="authenticateAdmin()">Authenticate</button>
                        </div>
                        <div id="adminProjectsSection" style="display: none;">
                            <h4 style="color: #f1f5f9; margin: 16px 0;">All Projects</h4>
                            <div class="admin-project-list" id="adminProjectList">
                                <!-- Projects will be listed here -->
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            <div class="form-actions">
                <button type="button" class="btn-cancel" onclick="resetToDefaults()">Reset to Defaults</button>
                <button type="button" class="btn-save" onclick="saveSettings()">Save Settings</button>
            </div>
        </div>
    </div>

    <!-- Experience Modal -->
    <div id="experienceModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2 class="modal-title" id="experienceModalTitle">Add New Experience</h2>
                <span class="close" onclick="closeExperienceModal()">&times;</span>
            </div>
            <div class="modal-body">
                <form id="experienceForm">
                    <div class="form-group">
                        <label for="experienceName">Experience Name</label>
                        <input type="text" id="experienceName" required>
                    </div>
                    <div class="form-row">
                        <div class="form-group">
                            <label for="experienceType">Type</label>
                            <select id="experienceType" required>
                                <option value="VR">Virtual Reality (VR)</option>
                                <option value="AR">Augmented Reality (AR)</option>
                                <option value="MR">Mixed Reality (MR)</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label for="experienceDuration">Duration (minutes)</label>
                            <input type="number" id="experienceDuration" min="1" max="120" value="30">
                        </div>
                    </div>
                    <div class="form-group">
                        <label for="experienceDescription">Description</label>
                        <textarea id="experienceDescription" required></textarea>
                    </div>
                    <div class="form-group">
                        <label>Hardware Requirements</label>
                        <div class="multi-select" id="hardwareSelect">
                            <!-- Will be populated by JavaScript -->
                        </div>
                    </div>
                    <div class="form-group">
                        <label>Software Requirements</label>
                        <div class="multi-select" id="softwareSelect">
                            <!-- Will be populated by JavaScript -->
                        </div>
                    </div>
                    <div class="form-group">
                        <label>Space Requirements</label>
                        <div class="multi-select" id="spaceSelect">
                            <!-- Will be populated by JavaScript -->
                        </div>
                    </div>
                </form>
            </div>
            <div class="form-actions">
                <button type="button" class="btn-cancel" onclick="closeExperienceModal()">Cancel</button>
                <button type="button" class="btn-save" onclick="saveExperience()">Save Experience</button>
            </div>
        </div>
    </div>

    <!-- Venue Modal -->
    <div id="venueModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2 class="modal-title" id="venueModalTitle">Add New Venue</h2>
                <span class="close" onclick="closeVenueModal()">&times;</span>
            </div>
            <div class="modal-body">
                <form id="venueForm">
                    <div class="form-group">
                        <label for="venueName">Venue Name</label>
                        <input type="text" id="venueName" required>
                    </div>
                    <div class="form-row">
                        <div class="form-group">
                            <label for="venueCapacity">Capacity (people)</label>
                            <input type="number" id="venueCapacity" min="1" required>
                        </div>
                        <div class="form-group">
                            <label for="venueArea">Area (sqm)</label>
                            <input type="number" id="venueArea" min="1" required>
                        </div>
                    </div>
                    <div class="form-group">
                        <label for="venueLocation">Location</label>
                        <input type="text" id="venueLocation" required>
                    </div>
                    <div class="form-group">
                        <label for="venueDescription">Description</label>
                        <textarea id="venueDescription"></textarea>
                    </div>
                    
                    <!-- Spaces Management Section -->
                    <div class="form-group">
                        <div class="spaces-header">
                            <label>Venue Spaces</label>
                            <button type="button" class="add-space-btn" onclick="showSpaceForm()">+ Add Space</button>
                        </div>
                        
                        <!-- Space Form (hidden by default) -->
                        <div id="spaceForm" class="space-form" style="display: none;">
                            <div class="space-form-header">
                                <h4 class="space-form-title" id="spaceFormTitle">Add New Space</h4>
                                <button type="button" class="btn-icon" onclick="hideSpaceForm()">✕</button>
                            </div>
                            <div class="form-row">
                                <div class="form-group">
                                    <label for="spaceName">Space Name</label>
                                    <input type="text" id="spaceName" placeholder="e.g. Main Hall, Demo Room">
                                </div>
                                <div class="form-group">
                                    <label for="spaceCapacity">Capacity (people)</label>
                                    <input type="number" id="spaceCapacity" min="1" placeholder="50">
                                </div>
                            </div>
                            <div class="form-row">
                                <div class="form-group">
                                    <label for="spaceArea">Area (sqm)</label>
                                    <input type="number" id="spaceArea" min="1" placeholder="100">
                                </div>
                                <div class="form-group" style="display: flex; align-items: flex-end;">
                                    <button type="button" class="btn-primary" onclick="saveSpace()" style="width: 100%;">
                                        <span id="spaceSubmitText">Add Space</span>
                                    </button>
                                </div>
                            </div>
                            <div class="form-group">
                                <label for="spaceDescription">Description</label>
                                <textarea id="spaceDescription" placeholder="Brief description of this space..."></textarea>
                            </div>
                        </div>
                        
                        <!-- Spaces List -->
                        <div id="venueSpacesList" class="spaces-list">
                            <!-- Spaces will be populated here -->
                        </div>
                    </div>
                </form>
            </div>
            <div class="form-actions">
                <button type="button" class="btn-cancel" onclick="closeVenueModal()">Cancel</button>
                <button type="button" class="btn-save" onclick="saveVenue()">Save Venue</button>
            </div>
        </div>
    </div>

    <script>
        // Firebase configuration - Replace with your own config
        // Your web app's Firebase configuration
		const firebaseConfig = {
		  apiKey: "AIzaSyB3Vnmc6LLM8zvcfTdyNTAiZziD9IBhHkw",
		  authDomain: "events-4e-02.firebaseapp.com",
		  projectId: "events-4e-02",
		  storageBucket: "events-4e-02.firebasestorage.app",
		  messagingSenderId: "489418004363",
		  appId: "1:489418004363:web:4e5c9a6ee2df2aea47818e"
		};
        // Initialize Firebase
        let app, database, auth;
        let currentUser = null;
        let currentProjectId = null;
        let dbRef = null;
        let isOnline = false;
        let firebaseInitialized = false;

        // Password entry state
        let pendingProjectId = null;
        let enteredPassword = '';

        // Admin state
        let isAdminAuthenticated = false;
        const ADMIN_PASSWORD = 'admin123'; // Change this to a secure password

        // Template data
        const templateData = {
            appSettings: {
                appTitle: 'XR Innovation Summit 2024',
                appLogo: null,
                defaultDuration: 30
            },
            eventConfig: {
                eventName: 'XR Innovation Summit 2024',
                startDate: '', // Will be set dynamically
                endDate: '', // Will be set dynamically
                timeZone: 'America/New_York',
                defaultBufferTime: 15,
                dailySchedules: [] // Will be generated dynamically
            },
            venues: [
                {
                    id: 1,
                    name: "Innovation Center",
                    capacity: 200,
                    area: 500,
                    location: "Building A, Main Campus",
                    description: "State-of-the-art facility with full XR capabilities",
                    spaces: [
                        { id: 1, name: "Main Hall", capacity: 150, area: 300, description: "Large open space for keynotes" },
                        { id: 2, name: "VR Lab", capacity: 30, area: 100, description: "Dedicated VR experience room" },
                        { id: 3, name: "Demo Area", capacity: 20, area: 100, description: "Product demonstration space" }
                    ]
                },
                {
                    id: 2,
                    name: "Tech Pavilion",
                    capacity: 100,
                    area: 250,
                    location: "Building B, East Wing",
                    description: "Modern space for hands-on workshops",
                    spaces: [
                        { id: 1, name: "Workshop Room", capacity: 50, area: 125, description: "Interactive workshop space" },
                        { id: 2, name: "AR Studio", capacity: 50, area: 125, description: "Augmented reality showcase" }
                    ]
                }
            ],
            experiences: [
                {
                    id: 1,
                    name: "Virtual City Tour",
                    type: "VR",
                    duration: 45,
                    description: "Immersive virtual reality tour of future smart cities",
                    hardware: ["VR Headset", "Motion Controllers"],
                    software: ["Unity", "WebXR"],
                    space: ["Room Scale VR", "Standing Area"]
                },
                {
                    id: 2,
                    name: "AR Product Showcase",
                    type: "AR",
                    duration: 30,
                    description: "Interactive AR demonstration of new product features",
                    hardware: ["AR Glasses", "Tracking Sensors"],
                    software: ["A-Frame", "WebXR"],
                    space: ["Standing Area", "Large Play Area"]
                },
                {
                    id: 3,
                    name: "Mixed Reality Workshop",
                    type: "MR",
                    duration: 60,
                    description: "Hands-on workshop combining physical and digital elements",
                    hardware: ["VR Headset", "AR Glasses", "Haptic Gloves"],
                    software: ["Unity", "Unreal Engine"],
                    space: ["Large Play Area", "Motion Capture"]
                }
            ],
            scheduledSessions: [] // Start with empty sessions so users can schedule their own
        };

        // Default settings and configuration
        const defaultSettings = {
            appTitle: '4E Event Planner',
            appLogo: null,
            defaultDuration: 30,
            hardwareOptions: ['VR Headset', 'AR Glasses', 'Motion Controllers', 'Haptic Gloves', 'Tracking Sensors', '4K Display', 'Sound System'],
            softwareOptions: ['Unity', 'Unreal Engine', 'WebXR', 'A-Frame', 'Mozilla Hubs', 'VRChat', 'Spatial'],
            spaceOptions: ['Room Scale VR', 'Seated Experience', 'Standing Area', 'Large Play Area', 'Projection Space', 'Green Screen', 'Motion Capture']
        };

        const defaultEventConfig = {
            eventName: 'XR Innovation Expo 2024',
            startDate: '2024-06-15',
            endDate: '2024-06-17',
            timeZone: 'America/New_York',
            defaultBufferTime: 5,
            dailySchedules: []
        };

        // Application state
        let appSettings = { ...defaultSettings };
        let eventConfig = { ...defaultEventConfig };
        let venues = [];
        let experiences = [];
        let scheduledSessions = [];

        // UI state
        let selectedVenue = null;
        let editingExperience = null;
        let editingVenue = null;
        let editingSpace = null;
        let currentView = 'experiences'; // 'experiences' or 'agenda'
        let agendaViewMode = 'grid'; // 'grid' or 'list'
        let agendaTimeMode = 'multiday'; // 'multiday' or 'single'
        let selectedAgendaDate = null;
        let sidebarMode = 'venues'; // 'venues' or 'experiences'
        
        // Fullscreen agenda state
        let fullscreenViewMode = 'grid';
        let fullscreenTimeMode = 'multiday';
        let fullscreenSelectedDate = null;
        
        // Drag & Drop variables
        let draggedExperience = null;
        let quickSchedulePopup = null;
        let dragPreviewCells = [];
        
        // Session interaction variables - Enhanced from 042c
        let isDraggingSession = false;
        let isResizingSession = false;
        let draggedSession = null;
        let resizeStartY = 0;
        let resizeStartSlots = 0;
        let duplicatePreviewCells = [];
        let dragPreviewElement = null;
        let dragStartX = 0;
        let dragStartY = 0;

        // For venue modal temporary spaces
        window.tempVenueSpaces = [];

        // Initialize Firebase and check config
        function initializeFirebase() {
            try {
                // Check if config is set up
                if (firebaseConfig.apiKey === "YOUR_API_KEY") {
                    console.log("Firebase not configured - running in offline mode");
                    initializeOfflineMode();
                    return;
                }

                // Initialize Firebase
                app = firebase.initializeApp(firebaseConfig);
                database = firebase.database();
                auth = firebase.auth();
                firebaseInitialized = true;

                // Set up authentication
                auth.signInAnonymously()
                    .then(() => {
                        console.log("Signed in anonymously");
                        setupConnectionMonitoring();
                        
                        // Check if we have a saved project
                        const savedProjectId = localStorage.getItem('current_project_id');
                        if (savedProjectId && !savedProjectId.startsWith('offline_')) {
                            // Verify project still exists
                            database.ref(`projects/${savedProjectId}`).once('value', (snapshot) => {
                                if (snapshot.exists()) {
                                    currentProjectId = savedProjectId;
                                    loadProjectData();
                                } else {
                                    localStorage.removeItem('current_project_id');
                                    showProjectSelector();
                                }
                            });
                        } else {
                            showProjectSelector();
                        }
                    })
                    .catch((error) => {
                        console.error("Auth error:", error);
                        initializeOfflineMode();
                    });

                // Monitor auth state
                auth.onAuthStateChanged((user) => {
                    currentUser = user;
                    if (user) {
                        console.log("User authenticated:", user.uid);
                    }
                });

            } catch (error) {
                console.error("Firebase initialization error:", error);
                initializeOfflineMode();
            }
        }

        // Initialize offline mode
        function initializeOfflineMode() {
            isOnline = false;
            updateConnectionStatus(false);
            
            // Load from localStorage if available
            const savedProject = localStorage.getItem('xr_event_planner_data');
            if (savedProject) {
                const data = JSON.parse(savedProject);
                appSettings = data.appSettings || { ...defaultSettings };
                eventConfig = data.eventConfig || { ...defaultEventConfig };
                venues = data.venues || [];
                experiences = data.experiences || [];
                scheduledSessions = data.scheduledSessions || [];
            }
            
            initializeApp();
        }

        // Connection monitoring
        function setupConnectionMonitoring() {
            const connectedRef = database.ref('.info/connected');
            connectedRef.on('value', (snap) => {
                isOnline = snap.val() === true;
                updateConnectionStatus(isOnline);
            });
        }

        function updateConnectionStatus(connected) {
            const statusEl = document.getElementById('connectionStatus');
            if (connected) {
                statusEl.className = 'connection-status connected';
                statusEl.innerHTML = '<div class="online-indicator"></div><span>Live</span>';
            } else {
                statusEl.className = 'connection-status disconnected';
                statusEl.innerHTML = '<div class="offline-indicator"></div><span>Offline Mode</span>';
            }
        }

        // Project management
        function showProjectSelector() {
            document.getElementById('projectModal').style.display = 'block';
            loadProjects();
        }

        function loadProjects() {
            if (!firebaseInitialized || !currentUser) {
                initializeOfflineMode();
                return;
            }

            // Load ALL projects from the database, not just user's projects
            const projectsRef = database.ref('projects');
            projectsRef.once('value', (snapshot) => {
                const allProjects = snapshot.val() || {};
                const projectList = document.getElementById('projectList');
                projectList.innerHTML = '';

                // Also get user's own projects to mark them
                database.ref(`users/${currentUser.uid}/projects`).once('value', (userSnapshot) => {
                    const userProjects = userSnapshot.val() || {};

                    Object.entries(allProjects).forEach(([id, project]) => {
                        const isOwner = project.owner === currentUser.uid;
                        const hasAccess = userProjects.hasOwnProperty(id);
                        
                        const projectItem = document.createElement('div');
                        projectItem.className = 'project-item';
                        projectItem.innerHTML = `
                            <div class="project-info">
                                <h3>${project.name}</h3>
                                <p>Last updated: ${new Date(project.lastUpdated).toLocaleDateString()}</p>
                                ${isOwner ? '<p style="color: #3b82f6; font-size: 0.8rem;">Owner</p>' : ''}
                                ${!isOwner && hasAccess ? '<p style="color: #22c55e; font-size: 0.8rem;">Team Member</p>' : ''}
                            </div>
                            ${isOwner ? `
                            <div class="project-actions">
                                <button class="project-action-btn" onclick="event.stopPropagation(); deleteUserProject('${id}')">Delete</button>
                            </div>
                            ` : ''}
                            <div class="project-status ${isOnline ? '' : 'offline'}">
                                <div class="${isOnline ? 'online-indicator' : 'offline-indicator'}"></div>
                                <span>${isOnline ? 'Online' : 'Offline'}</span>
                            </div>
                        `;
                        projectItem.onclick = () => attemptProjectSelection(id);
                        projectList.appendChild(projectItem);
                    });

                    if (Object.keys(allProjects).length === 0) {
                        projectList.innerHTML = '<p style="text-align: center; color: #94a3b8;">No projects available. Create your first project!</p>';
                    }
                });
            });
        }

        function deleteUserProject(projectId) {
            if (!confirm('Are you sure you want to delete this project? This cannot be undone.')) {
                return;
            }

            if (!firebaseInitialized || !currentUser) {
                alert('Cannot delete projects in offline mode');
                return;
            }

            // Check if user is the owner
            database.ref(`projects/${projectId}/owner`).once('value', (snapshot) => {
                const owner = snapshot.val();
                if (owner !== currentUser.uid) {
                    alert('You can only delete projects you own.');
                    return;
                }

                // Delete the entire project
                database.ref(`projects/${projectId}`).remove()
                    .then(() => {
                        // Remove from all users' project lists
                        return database.ref('users').once('value', (snapshot) => {
                            const users = snapshot.val() || {};
                            const promises = [];
                            Object.keys(users).forEach(userId => {
                                promises.push(database.ref(`users/${userId}/projects/${projectId}`).remove());
                            });
                            return Promise.all(promises);
                        });
                    })
                    .then(() => {
                        // If it's the current project, clear it
                        if (currentProjectId === projectId) {
                            currentProjectId = null;
                            localStorage.removeItem('current_project_id');
                            if (dbRef) {
                                dbRef.off(); // Remove all listeners
                            }
                        }
                        loadProjects();
                    })
                    .catch((error) => {
                        console.error("Error deleting project:", error);
                        alert("Error deleting project. Please try again.");
                    });
            });
        }

        function createNewProject(fromTemplate) {
            const projectName = prompt("Enter project name:");
            if (!projectName) return;

            // Ask for custom password
            let password = prompt("Enter a 6-digit password for this project (leave blank to auto-generate):");
            
            if (password && password.length !== 6) {
                alert("Password must be exactly 6 digits. Auto-generating instead.");
                password = null;
            }
            
            if (!password) {
                password = generatePassword();
                alert(`Project password: ${password}\n\nPlease save this password to share with your team!`);
            }

            if (!firebaseInitialized || !currentUser) {
                // Offline mode
                currentProjectId = 'offline_' + Date.now();
                localStorage.setItem('current_project_id', currentProjectId);
                
                if (fromTemplate) {
                    appSettings = { ...defaultSettings, ...templateData.appSettings };
                    eventConfig = { ...defaultEventConfig, ...templateData.eventConfig };
                    venues = [...templateData.venues];
                    experiences = [...templateData.experiences];
                    scheduledSessions = [...templateData.scheduledSessions];
                    // Generate daily schedules for template
                    generateDailySchedules();
                } else {
                    appSettings = { ...defaultSettings };
                    eventConfig = { ...defaultEventConfig };
                    venues = [];
                    experiences = [];
                    scheduledSessions = [];
                    // Set default dates and generate schedules
                    const today = new Date();
                    const nextWeek = new Date(today.getTime() + 7 * 24 * 60 * 60 * 1000);
                    eventConfig.startDate = today.toISOString().split('T')[0];
                    eventConfig.endDate = nextWeek.toISOString().split('T')[0];
                    generateDailySchedules();
                }
                
                document.getElementById('projectModal').style.display = 'none';
                initializeApp();
                return;
            }

            // For template, ensure dates are set properly
            let projectEventConfig = { ...defaultEventConfig };
            if (fromTemplate) {
                projectEventConfig = { ...defaultEventConfig, ...templateData.eventConfig };
                // Ensure dates are set
                if (!projectEventConfig.startDate || !projectEventConfig.endDate) {
                    const today = new Date();
                    const endDate = new Date(today.getTime() + 2 * 24 * 60 * 60 * 1000);
                    projectEventConfig.startDate = today.toISOString().split('T')[0];
                    projectEventConfig.endDate = endDate.toISOString().split('T')[0];
                }
            } else {
                const today = new Date();
                const nextWeek = new Date(today.getTime() + 7 * 24 * 60 * 60 * 1000);
                projectEventConfig.startDate = today.toISOString().split('T')[0];
                projectEventConfig.endDate = nextWeek.toISOString().split('T')[0];
            }

            const projectData = {
                name: projectName,
                password: password,
                created: Date.now(),
                lastUpdated: Date.now(),
                owner: currentUser.uid,
                appSettings: fromTemplate ? { ...defaultSettings, ...templateData.appSettings } : { ...defaultSettings },
                eventConfig: projectEventConfig,
                venues: fromTemplate ? templateData.venues : [],
                experiences: fromTemplate ? templateData.experiences : [],
                scheduledSessions: fromTemplate ? templateData.scheduledSessions : []
            };

            // Generate daily schedules based on the dates
            const startDate = new Date(projectEventConfig.startDate + 'T12:00:00');
            const endDate = new Date(projectEventConfig.endDate + 'T12:00:00');
            projectData.eventConfig.dailySchedules = [];
            
            for (let date = new Date(startDate); date <= endDate; date.setUTCDate(date.getUTCDate() + 1)) {
                projectData.eventConfig.dailySchedules.push({
                    date: date.toISOString().split('T')[0],
                    startTime: '09:00',
                    endTime: '18:00',
                    isEventDay: true
                });
            }

            const newProjectRef = database.ref(`projects`).push();
            const projectId = newProjectRef.key;

            // Create project
            newProjectRef.set(projectData).then(() => {
                // Add to user's projects
                return database.ref(`users/${currentUser.uid}/projects/${projectId}`).set({
                    name: projectName,
                    lastUpdated: Date.now()
                });
            }).then(() => {
                selectProject(projectId);
            }).catch((error) => {
                console.error("Error creating project:", error);
                alert("Error creating project. Please try again.");
            });
        }

        function cancelProjectSelection() {
            // Only allow cancel if we already have a project loaded
            if (currentProjectId) {
                document.getElementById('projectModal').style.display = 'none';
            } else {
                alert("Please select or create a project to continue.");
            }
        }

        function generatePassword() {
            return Math.floor(100000 + Math.random() * 900000).toString();
        }

        function attemptProjectSelection(projectId) {
            pendingProjectId = projectId;
            
            // Check if project has password
            database.ref(`projects/${projectId}/password`).once('value', (snapshot) => {
                if (snapshot.exists()) {
                    // Show password modal
                    enteredPassword = '';
                    updatePasswordDisplay();
                    document.getElementById('passwordModal').style.display = 'block';
                } else {
                    // Legacy project without password - add one
                    const password = generatePassword();
                    database.ref(`projects/${projectId}/password`).set(password).then(() => {
                        alert(`Password has been set for this project: ${password}\n\nPlease save this password!`);
                        selectProject(projectId);
                    });
                }
            });
        }

        // Password entry functions
        function addPasswordDigit(digit) {
            if (enteredPassword.length < 6) {
                enteredPassword += digit;
                updatePasswordDisplay();
                
                if (enteredPassword.length === 6) {
                    // Auto-submit when 6 digits entered
                    setTimeout(submitPassword, 100);
                }
            }
        }

        function clearPassword() {
            enteredPassword = '';
            updatePasswordDisplay();
        }

        function updatePasswordDisplay() {
            const display = document.getElementById('passwordDisplay');
            let displayText = '';
            for (let i = 0; i < 6; i++) {
                if (i < enteredPassword.length) {
                    displayText += '•';
                } else {
                    displayText += '-';
                }
            }
            display.textContent = displayText;
        }

        function submitPassword() {
            if (enteredPassword.length !== 6) {
                alert('Please enter a 6-digit password');
                return;
            }

            // Check password
            database.ref(`projects/${pendingProjectId}/password`).once('value', (snapshot) => {
                const correctPassword = snapshot.val();
                if (enteredPassword === correctPassword) {
                    document.getElementById('passwordModal').style.display = 'none';
                    selectProject(pendingProjectId);
                } else {
                    alert('Incorrect password. Please try again.');
                    clearPassword();
                }
            });
        }

        function cancelPasswordEntry() {
            document.getElementById('passwordModal').style.display = 'none';
            pendingProjectId = null;
            enteredPassword = '';
        }

        function selectProject(projectId) {
            currentProjectId = projectId;
            localStorage.setItem('current_project_id', projectId);
            document.getElementById('projectModal').style.display = 'none';

            if (firebaseInitialized && currentUser) {
                // Add this project to user's projects list if not already there
                database.ref(`users/${currentUser.uid}/projects/${projectId}`).once('value', (snapshot) => {
                    if (!snapshot.exists()) {
                        // Get project name
                        database.ref(`projects/${projectId}/name`).once('value', (nameSnapshot) => {
                            const projectName = nameSnapshot.val() || 'Unnamed Project';
                            // Add to user's project list
                            database.ref(`users/${currentUser.uid}/projects/${projectId}`).set({
                                name: projectName,
                                lastUpdated: Date.now()
                            });
                        });
                    }
                });
                
                setupRealtimeSync();
            }
            
            loadProjectData();
        }

        function changeProject() {
            if (dbRef) {
                dbRef.off(); // Remove all listeners
            }
            showProjectSelector();
        }

        // Admin functions
        function toggleAdminSection() {
            const adminContent = document.getElementById('adminContent');
            adminContent.classList.toggle('active');
        }

        function authenticateAdmin() {
            const password = document.getElementById('adminPassword').value;
            if (password === ADMIN_PASSWORD) {
                isAdminAuthenticated = true;
                document.getElementById('adminProjectsSection').style.display = 'block';
                loadAllProjects();
                document.getElementById('adminPassword').value = '';
            } else {
                alert('Incorrect admin password');
            }
        }

        function loadAllProjects() {
            if (!isAdminAuthenticated || !firebaseInitialized) return;

            database.ref('projects').once('value', (snapshot) => {
                const allProjects = snapshot.val() || {};
                const adminProjectList = document.getElementById('adminProjectList');
                adminProjectList.innerHTML = '';

                Object.entries(allProjects).forEach(([id, project]) => {
                    const projectItem = document.createElement('div');
                    projectItem.className = 'admin-project-item';
                    projectItem.innerHTML = `
                        <div class="admin-project-info">
                            <div class="admin-project-name">${project.name}</div>
                            <div class="admin-project-details">
                                ID: ${id.substring(0, 8)}... | 
                                Password: ${project.password || 'None'} | 
                                Created: ${new Date(project.created).toLocaleDateString()}
                            </div>
                        </div>
                        <button class="project-action-btn" onclick="deleteProjectAsAdmin('${id}')">Delete</button>
                    `;
                    adminProjectList.appendChild(projectItem);
                });
            });
        }

        function deleteProjectAsAdmin(projectId) {
            if (!isAdminAuthenticated) return;

            if (confirm('Are you sure you want to permanently delete this project? This cannot be undone.')) {
                // Delete the project
                database.ref(`projects/${projectId}`).remove()
                    .then(() => {
                        // Remove from all users' project lists
                        database.ref('users').once('value', (snapshot) => {
                            const users = snapshot.val() || {};
                            const promises = [];
                            Object.keys(users).forEach(userId => {
                                promises.push(database.ref(`users/${userId}/projects/${projectId}`).remove());
                            });
                            return Promise.all(promises);
                        });
                    })
                    .then(() => {
                        loadAllProjects();
                        alert('Project deleted successfully');
                        
                        // If the deleted project was the current one, force project selection
                        if (currentProjectId === projectId) {
                            currentProjectId = null;
                            localStorage.removeItem('current_project_id');
                            if (dbRef) {
                                dbRef.off(); // Remove all listeners
                            }
                            showProjectSelector();
                        }
                    })
                    .catch((error) => {
                        console.error("Error deleting project:", error);
                        alert("Error deleting project. Please try again.");
                    });
            }
        }

        // Toggle venue selection
        function selectVenue(venue) {
            if (selectedVenue?.id === venue.id) {
                // Deselect if clicking the same venue
                selectedVenue = null;
            } else {
                // Select new venue
                selectedVenue = venue;
            }
            
            renderVenues();
            
            if (currentView === 'experiences') {
                renderExperiences();
            } else {
                renderAgendaView();
            }
            
            updatePanelTitle();
        }

        // Realtime sync setup
        function setupRealtimeSync() {
            if (!currentProjectId || !firebaseInitialized) return;

            dbRef = database.ref(`projects/${currentProjectId}`);

            // Listen for settings changes
            dbRef.child('appSettings').on('value', (snapshot) => {
                if (snapshot.exists()) {
                    appSettings = snapshot.val();
                    updateHeaderDisplay();
                }
            });

            // Listen for event config changes
            dbRef.child('eventConfig').on('value', (snapshot) => {
                if (snapshot.exists()) {
                    eventConfig = snapshot.val();
                    if (currentView === 'agenda') {
                        renderAgendaView();
                    }
                }
            });

            // Listen for venues changes
            dbRef.child('venues').on('value', (snapshot) => {
                venues = snapshot.val() ? Object.values(snapshot.val()) : [];
                renderVenues();
            });

            // Listen for experiences changes
            dbRef.child('experiences').on('value', (snapshot) => {
                experiences = snapshot.val() ? Object.values(snapshot.val()) : [];
                renderExperiences();
                if (sidebarMode === 'experiences') {
                    populateSidebarExperiences();
                }
            });

            // Listen for scheduled sessions changes
            dbRef.child('scheduledSessions').on('value', (snapshot) => {
                scheduledSessions = snapshot.val() ? Object.values(snapshot.val()) : [];
                if (currentView === 'agenda') {
                    renderAgendaView();
                }
            });
        }

        // Load project data
        function loadProjectData() {
            if (!currentProjectId) {
                initializeApp();
                return;
            }

            if (firebaseInitialized) {
                dbRef = database.ref(`projects/${currentProjectId}`);
                dbRef.once('value', (snapshot) => {
                    if (snapshot.exists()) {
                        const data = snapshot.val();
                        appSettings = data.appSettings || { ...defaultSettings };
                        eventConfig = data.eventConfig || { ...defaultEventConfig };
                        venues = data.venues ? Object.values(data.venues) : [];
                        experiences = data.experiences ? Object.values(data.experiences) : [];
                        scheduledSessions = data.scheduledSessions ? Object.values(data.scheduledSessions) : [];
                        initializeApp();
                    } else {
                        initializeApp();
                    }
                });
            } else {
                initializeApp();
            }
        }

        // Save data to Firebase
        function saveToFirebase(path, data) {
            if (!firebaseInitialized || !currentProjectId) {
                // Save to localStorage in offline mode
                saveToLocalStorage();
                return Promise.resolve();
            }

            showSyncIndicator();
            
            return database.ref(`projects/${currentProjectId}/${path}`).set(data)
                .then(() => {
                    // Update last updated timestamp
                    return database.ref(`projects/${currentProjectId}/lastUpdated`).set(Date.now());
                })
                .then(() => {
                    if (currentUser) {
                        return database.ref(`users/${currentUser.uid}/projects/${currentProjectId}/lastUpdated`).set(Date.now());
                    }
                })
                .then(() => {
                    hideSyncIndicator();
                })
                .catch((error) => {
                    console.error("Save error:", error);
                    hideSyncIndicator();
                    alert("Error saving data. Changes saved locally.");
                    saveToLocalStorage();
                });
        }

        // Save to localStorage
        function saveToLocalStorage() {
            const data = {
                appSettings,
                eventConfig,
                venues,
                experiences,
                scheduledSessions,
                lastUpdated: Date.now()
            };
            localStorage.setItem('xr_event_planner_data', JSON.stringify(data));
        }

        // Sync indicators
        function showSyncIndicator() {
            const indicator = document.getElementById('syncIndicator');
            indicator.style.display = 'block';
        }

        function hideSyncIndicator() {
            setTimeout(() => {
                const indicator = document.getElementById('syncIndicator');
                indicator.style.display = 'none';
            }, 1000);
        }

        // Initialize the app
        function initializeApp() {
            updateHeaderDisplay();
            renderVenues();
            renderExperiences();
            switchToExperiencesView();
            setSidebarMode('venues');
            
            // Set default dates if not set
            if (!eventConfig.startDate || !eventConfig.endDate) {
                const today = new Date();
                const nextWeek = new Date(today.getTime() + 7 * 24 * 60 * 60 * 1000);
                eventConfig.startDate = today.toISOString().split('T')[0];
                eventConfig.endDate = nextWeek.toISOString().split('T')[0];
            }
            
            generateDailySchedules();
        }

        // [ALL YOUR EXISTING FUNCTIONS REMAIN EXACTLY THE SAME]
        // Enhanced session drag functionality from 042c
        function startSessionDrag(event, sessionId) {
            // Don't start drag if clicking on action buttons or resize handle
            if (event.target.closest('.session-action-btn') || event.target.closest('.session-resize-handle')) {
                return;
            }
            
            event.preventDefault();
            
            isDraggingSession = true;
            draggedSession = scheduledSessions.find(s => s.id === sessionId);
            
            if (!draggedSession) return;
            
            // Find the experience for this session
            draggedExperience = experiences.find(exp => exp.id === draggedSession.experienceId);
            
            dragStartX = event.clientX;
            dragStartY = event.clientY;
            
            // Add dragging class to the session element
            const sessionElement = event.target.closest('.experience-session');
            if (sessionElement) {
                sessionElement.classList.add('dragging-move');
            }
            
            // Create drag preview element
            createDragPreview(event, draggedSession);
            
            // Add global mouse event listeners
            document.addEventListener('mousemove', handleSessionDragMove);
            document.addEventListener('mouseup', handleSessionDragEnd);
            
            // Add drop zones to grid
            addSessionDropZones();
            
            // Show instruction message
            const instructionMsg = document.createElement('div');
            instructionMsg.id = 'dragInstruction';
            instructionMsg.className = 'drag-instruction';
            instructionMsg.textContent = '🎯 Dragging session: Drop in empty slot to move';
            document.body.appendChild(instructionMsg);
        }

        function createDragPreview(event, session) {
            dragPreviewElement = document.createElement('div');
            dragPreviewElement.className = `experience-session ${session.experienceType.toLowerCase()} drag-preview-element`;
            
            dragPreviewElement.innerHTML = `
                <div class="session-main-title">${session.experienceName}</div>
                <div class="session-meta">${formatTime12Hour(session.startTime)} - ${formatTime12Hour(session.endTime)}</div>
            `;
            
            // Position at cursor
            dragPreviewElement.style.left = (event.clientX - 100) + 'px';
            dragPreviewElement.style.top = (event.clientY - 30) + 'px';
            
            document.body.appendChild(dragPreviewElement);
        }

        function handleSessionDragMove(event) {
            if (!isDraggingSession || !dragPreviewElement) return;
            
            // Update preview position
            dragPreviewElement.style.left = (event.clientX - 100) + 'px';
            dragPreviewElement.style.top = (event.clientY - 30) + 'px';
            
            // Show drop preview on grid cells
            const elementBelow = document.elementFromPoint(event.clientX, event.clientY);
            const gridCell = elementBelow?.closest('.grid-cell');
            
            // Clear previous previews
            clearDragPreview();
            
            if (gridCell && !gridCell.classList.contains('occupied') && draggedExperience) {
                const slotsNeeded = calculateSlotsNeeded(draggedExperience);
                showDragPreview(gridCell, slotsNeeded);
            }
        }

        function handleSessionDragEnd(event) {
            if (!isDraggingSession) return;
            
            // Remove preview element
            if (dragPreviewElement) {
                dragPreviewElement.remove();
                dragPreviewElement = null;
            }
            
            // Check if we're dropping on a valid cell
            const elementBelow = document.elementFromPoint(event.clientX, event.clientY);
            const gridCell = elementBelow?.closest('.grid-cell');
            
            if (gridCell && !gridCell.classList.contains('occupied')) {
                // Valid drop - handle the move
                handleSessionDropOnCell(gridCell);
            }
            
            // Clean up
            removeSessionDropZones();
            clearDragPreview();
            
            // Remove instruction message
            const instructionMsg = document.getElementById('dragInstruction');
            if (instructionMsg) {
                instructionMsg.remove();
            }
            
            // Remove dragging class
            const draggingElement = document.querySelector('.dragging-move');
            if (draggingElement) {
                draggingElement.classList.remove('dragging-move');
            }
            
            // Remove global listeners
            document.removeEventListener('mousemove', handleSessionDragMove);
            document.removeEventListener('mouseup', handleSessionDragEnd);
            
            // Reset state
            isDraggingSession = false;
            draggedSession = null;
            draggedExperience = null;
            
            // Re-render agenda
			const isFullscreen = document.getElementById('fullscreenModal').classList.contains('active');
			if (isFullscreen) {
				renderFullscreenAgenda();
			} else {
				renderAgendaView();
			}
        }

        function addSessionDropZones() {
			// Check if we're in fullscreen mode
			const isFullscreen = document.getElementById('fullscreenModal').classList.contains('active');
			const containerSelector = isFullscreen 
				? '#fullscreen-grid-container .grid-cell:not(.occupied)'
				: '#grid-container .grid-cell:not(.occupied)';
			
			const cells = document.querySelectorAll(containerSelector);
			cells.forEach(cell => {
				cell.addEventListener('dragover', handleSessionDragOver);
				cell.addEventListener('dragleave', handleSessionDragLeave);
				cell.addEventListener('drop', handleSessionDrop);
			});
		}

        function removeSessionDropZones() {
            const cells = document.querySelectorAll('.grid-cell');
            cells.forEach(cell => {
                cell.classList.remove('drop-zone', 'drop-target', 'drop-preview', 'drop-invalid');
                cell.removeEventListener('dragover', handleSessionDragOver);
                cell.removeEventListener('dragleave', handleSessionDragLeave);
                cell.removeEventListener('drop', handleSessionDrop);
            });
        }

        function handleSessionDragOver(e) {
            e.preventDefault();
            
            if (!isDraggingSession || !draggedSession || !draggedExperience) return;
            
            clearDragPreview();
            const slotsNeeded = calculateSlotsNeeded(draggedExperience);
            showDragPreview(e.target, slotsNeeded);
        }

        function handleSessionDragLeave(e) {
            if (!e.relatedTarget || !e.currentTarget.contains(e.relatedTarget)) {
                clearDragPreview();
            }
        }

        function handleSessionDrop(e) {
            e.preventDefault();
            handleSessionDropOnCell(e.target);
        }

        function handleSessionDropOnCell(gridCell) {
            const dropInfo = extractDropInfo(gridCell);
            if (!dropInfo) return;
            
            // Calculate end time
            const startDate = new Date(`1970-01-01T${dropInfo.time}:00Z`);
            startDate.setUTCMinutes(startDate.getUTCMinutes() + draggedExperience.duration + eventConfig.defaultBufferTime);
            const endTime = startDate.toISOString().substr(11, 5);
            
            // Check for conflicts
            const conflict = scheduledSessions.find(session => 
                session.id !== draggedSession.id && // Don't check against itself
                session.venueId === dropInfo.venue.id && 
                session.spaceId === dropInfo.space.id && 
                session.date === dropInfo.date && 
                ((dropInfo.time >= session.startTime && dropInfo.time < session.endTime) ||
                 (endTime > session.startTime && endTime <= session.endTime))
            );
            
            if (conflict) {
                alert(`Conflict detected! Space "${dropInfo.space.name}" is already booked.`);
                return;
            }
            
            // Update the session with new location and time
            draggedSession.venueId = dropInfo.venue.id;
            draggedSession.venueName = dropInfo.venue.name;
            draggedSession.spaceId = dropInfo.space.id;
            draggedSession.spaceName = dropInfo.space.name;
            draggedSession.date = dropInfo.date;
            draggedSession.startTime = dropInfo.time;
            draggedSession.endTime = endTime;
            
            // Save to Firebase
            saveToFirebase('scheduledSessions', scheduledSessions);
            
            // Show success message
            const successMsg = document.createElement('div');
            successMsg.style.cssText = 'position: fixed; top: 20px; right: 20px; background: #22c55e; color: white; padding: 12px 20px; border-radius: 8px; z-index: 1002; font-weight: 600;';
            successMsg.textContent = '✅ Session moved successfully!';
            document.body.appendChild(successMsg);
            setTimeout(() => successMsg.remove(), 3000);
        }

        // Enhanced resize functionality from 042c
        function startSessionResize(event, sessionId) {
            event.preventDefault();
            event.stopPropagation();
            
            isResizingSession = true;
            draggedSession = scheduledSessions.find(s => s.id === sessionId);
            
            if (!draggedSession) return;
            
            resizeStartY = event.clientY;
            resizeStartSlots = calculateSessionSlots(draggedSession);
            
            // Add dragging class to the session element
            const sessionElement = document.querySelector(`[data-session-id="${sessionId}"]`);
            if (sessionElement) {
                sessionElement.classList.add('dragging-resize');
            }
            
            // Add global mouse event listeners
            document.addEventListener('mousemove', handleSessionResizeMouseMove);
            document.addEventListener('mouseup', handleSessionResizeMouseUp);
        }

        function handleSessionResizeMouseMove(event) {
            if (!isResizingSession || !draggedSession) return;
            
            const deltaY = event.clientY - resizeStartY;
            const slotHeight = 40;
            const additionalSlots = Math.floor(deltaY / slotHeight);
            
            if (additionalSlots > 0) {
                showDuplicatePreview(draggedSession, additionalSlots);
            } else {
                clearDuplicatePreview();
            }
        }

        function handleSessionResizeMouseUp(event) {
            if (isResizingSession && draggedSession) {
                const deltaY = event.clientY - resizeStartY;
                const slotHeight = 40;
                const additionalSlots = Math.floor(deltaY / slotHeight);
                
                if (additionalSlots > 0) {
                    createDuplicateSessions(draggedSession, additionalSlots);
                }
                
                // Clean up
                const sessionElement = document.querySelector('.dragging-resize');
                if (sessionElement) {
                    sessionElement.classList.remove('dragging-resize');
                }
                
                clearDuplicatePreview();
                
				// Re-render the appropriate view
				const isFullscreen = document.getElementById('fullscreenModal').classList.contains('active');
				if (isFullscreen) {
					renderFullscreenAgenda();
				} else {
					renderAgendaView();
				}
                
                isResizingSession = false;
                draggedSession = null;
            }
            
            // Remove global event listeners
            document.removeEventListener('mousemove', handleSessionResizeMouseMove);
            document.removeEventListener('mouseup', handleSessionResizeMouseUp);
        }

        function showDuplicatePreview(originalSession, additionalSlots) {
            clearDuplicatePreview();
            
            // Check which view we're in
			const isFullscreen = document.getElementById('fullscreenModal').classList.contains('active');
			const gridContainer = isFullscreen 
				? document.getElementById('fullscreen-grid-container')
				: document.getElementById('grid-container');
			
			if (!gridContainer) return;
			
			const cells = Array.from(gridContainer.children);
            const spaces = selectedVenue ? selectedVenue.spaces : getAllSpaces();
            const cols = spaces.length + 1;
            
            const eventDays = agendaTimeMode === 'single' 
                ? eventConfig.dailySchedules.filter(day => day.isEventDay && day.date === selectedAgendaDate)
                : eventConfig.dailySchedules.filter(day => day.isEventDay);
            
            if (eventDays.length === 0) return;
            
            const timeSlots = generateTimeSlots(eventDays[0]);
            const sessionStartIndex = timeSlots.indexOf(originalSession.startTime);
            const sessionSlots = calculateSessionSlots(originalSession);
            
            // Find which space this session is in
            const spaceIndex = spaces.findIndex(space => 
                space.id === originalSession.spaceId && 
                (space.venueId === originalSession.venueId || selectedVenue?.id === originalSession.venueId)
            );
            
            if (spaceIndex === -1) return;
            
            // Preview duplicates
            for (let i = 1; i <= additionalSlots; i++) {
                const newStartSlotIndex = sessionStartIndex + (sessionSlots * i);
                
                if (newStartSlotIndex >= timeSlots.length) break;
                
                const newStartTime = timeSlots[newStartSlotIndex];
                const experience = experiences.find(exp => exp.id === originalSession.experienceId);
                if (!experience) break;
                
                const sessionDuration = experience.duration + eventConfig.defaultBufferTime;
                const startDate = new Date(`1970-01-01T${newStartTime}:00Z`);
                startDate.setUTCMinutes(startDate.getUTCMinutes() + sessionDuration);
                const newEndTime = startDate.toISOString().substr(11, 5);
                
                // Check for conflicts
                let hasConflict = false;
                for (let j = 0; j < sessionSlots; j++) {
                    const slotIndex = newStartSlotIndex + j;
                    if (slotIndex >= timeSlots.length) {
                        hasConflict = true;
                        break;
                    }
                    
                    const checkTime = timeSlots[slotIndex];
                    const conflict = scheduledSessions.find(session => 
                        session.venueId === originalSession.venueId && 
                        session.spaceId === originalSession.spaceId && 
                        session.date === originalSession.date && 
                        session.startTime === checkTime
                    );
                    
                    if (conflict) {
                        hasConflict = true;
                        break;
                    }
                }
                
                // Show preview cells
                for (let j = 0; j < sessionSlots; j++) {
                    const slotIndex = newStartSlotIndex + j;
                    if (slotIndex < timeSlots.length) {
                        const cellIndex = (slotIndex + 1) * cols + (spaceIndex + 1);
                        if (cellIndex < cells.length) {
                            const cell = cells[cellIndex];
                            if (cell && cell.classList.contains('grid-cell')) {
                                cell.classList.add(hasConflict ? 'duplicate-invalid' : 'duplicate-preview');
                                duplicatePreviewCells.push(cell);
                            }
                        }
                    }
                }
                
                if (hasConflict) break;
            }
        }

        function clearDuplicatePreview() {
            duplicatePreviewCells.forEach(cell => {
                cell.classList.remove('duplicate-preview', 'duplicate-invalid');
            });
            duplicatePreviewCells = [];
        }

        function createDuplicateSessions(originalSession, additionalSlots) {
            const experience = experiences.find(exp => exp.id === originalSession.experienceId);
            if (!experience) return;
            
            const sessionDuration = experience.duration + eventConfig.defaultBufferTime;
            const slotsPerSession = Math.ceil(sessionDuration / 15);
            
            const eventDays = agendaTimeMode === 'single' 
                ? eventConfig.dailySchedules.filter(day => day.isEventDay && day.date === selectedAgendaDate)
                : eventConfig.dailySchedules.filter(day => day.isEventDay);
            
            if (eventDays.length === 0) return;
            
            const timeSlots = generateTimeSlots(eventDays[0]);
            const sessionStartIndex = timeSlots.indexOf(originalSession.startTime);
            const originalSlots = calculateSessionSlots(originalSession);
            
            let duplicatesCreated = 0;
            
            for (let i = 1; i <= additionalSlots; i++) {
                const newStartSlotIndex = sessionStartIndex + (originalSlots * i);
                
                if (newStartSlotIndex >= timeSlots.length) break;
                
                const newStartTime = timeSlots[newStartSlotIndex];
                const startDate = new Date(`1970-01-01T${newStartTime}:00Z`);
                startDate.setUTCMinutes(startDate.getUTCMinutes() + sessionDuration);
                const newEndTime = startDate.toISOString().substr(11, 5);
                
                // Check for conflicts
                const conflict = scheduledSessions.find(session => 
                    session.venueId === originalSession.venueId && 
                    session.spaceId === originalSession.spaceId && 
                    session.date === originalSession.date && 
                    ((newStartTime >= session.startTime && newStartTime < session.endTime) ||
                     (newEndTime > session.startTime && newEndTime <= session.endTime))
                );
                
                if (conflict) break;
                
                // Create duplicate session
                const newSession = {
                    id: scheduledSessions.length > 0 ? Math.max(...scheduledSessions.map(s => s.id)) + 1 : 1,
                    experienceId: originalSession.experienceId,
                    experienceName: originalSession.experienceName,
                    experienceType: originalSession.experienceType,
                    venueId: originalSession.venueId,
                    venueName: originalSession.venueName,
                    spaceId: originalSession.spaceId,
                    spaceName: originalSession.spaceName,
                    date: originalSession.date,
                    startTime: newStartTime,
                    endTime: newEndTime,
                    bufferTime: originalSession.bufferTime,
                    maxCapacity: originalSession.maxCapacity,
                    sessionNotes: `${originalSession.sessionNotes || ''} (duplicated)`.trim()
                };
                
                scheduledSessions.push(newSession);
                duplicatesCreated++;
            }
            
            if (duplicatesCreated > 0) {
                // Save to Firebase
                saveToFirebase('scheduledSessions', scheduledSessions);
                
                const successMsg = document.createElement('div');
                successMsg.style.cssText = 'position: fixed; top: 20px; right: 20px; background: #22c55e; color: white; padding: 12px 20px; border-radius: 8px; z-index: 1002; font-weight: 600;';
                successMsg.textContent = `✅ Created ${duplicatesCreated} duplicate session${duplicatesCreated > 1 ? 's' : ''}!`;
                document.body.appendChild(successMsg);
                setTimeout(() => successMsg.remove(), 3000);
            }
        }

        // Session interaction functions
        function showSessionInfo(sessionId) {
            const session = scheduledSessions.find(s => s.id === sessionId);
            if (!session) return;
            
            alert(`📋 Session Details\n\nExperience: ${session.experienceName}\nVenue: ${session.venueName}\nSpace: ${session.spaceName}\nDate: ${session.date}\nTime: ${session.startTime} - ${session.endTime}\nCapacity: ${session.maxCapacity} people\nBuffer: ${session.bufferTime} minutes\n\nNotes: ${session.sessionNotes || 'None'}`);
        }

        function deleteSession(sessionId) {
            if (confirm('Are you sure you want to delete this session?')) {
                scheduledSessions = scheduledSessions.filter(s => s.id !== sessionId);
                
                // Save to Firebase
                saveToFirebase('scheduledSessions', scheduledSessions);
                
				// Re-render the appropriate view
				const isFullscreen = document.getElementById('fullscreenModal').classList.contains('active');
				if (isFullscreen) {
					renderFullscreenAgenda();
				} else {
					renderAgendaView();
				}
                
                const successMsg = document.createElement('div');
                successMsg.style.cssText = 'position: fixed; top: 20px; right: 20px; background: #ef4444; color: white; padding: 12px 20px; border-radius: 8px; z-index: 1002; font-weight: 600;';
                successMsg.textContent = '🗑️ Session deleted successfully!';
                document.body.appendChild(successMsg);
                setTimeout(() => successMsg.remove(), 3000);
            }
        }

        // Utility functions
        function formatTime12Hour(time24) {
            const [hours, minutes] = time24.split(':');
            const hour = parseInt(hours);
            const period = hour >= 12 ? 'PM' : 'AM';
            const hour12 = hour === 0 ? 12 : hour > 12 ? hour - 12 : hour;
            return `${hour12}:${minutes} ${period}`;
        }

        function calculateSlotsNeeded(experience) {
            const duration = experience.duration + eventConfig.defaultBufferTime;
            return Math.ceil(duration / 15); // 15-minute slots
        }

        function calculateSessionSlots(session) {
            const startTime = new Date(`1970-01-01T${session.startTime}:00Z`);
            const endTime = new Date(`1970-01-01T${session.endTime}:00Z`);
            const durationMinutes = (endTime - startTime) / (1000 * 60);
            return Math.ceil(durationMinutes / 15);
        }

        function generateTimeSlots(day) {
            const slots = [];
            const startTime = day.startTime || '09:00';
            const endTime = day.endTime || '17:00';
            
            const start = new Date(`1970-01-01T${startTime}:00Z`);
            const end = new Date(`1970-01-01T${endTime}:00Z`);
            
            const current = new Date(start);
            while (current < end) {
                const timeString = current.toISOString().substr(11, 5);
                slots.push(timeString);
                current.setUTCMinutes(current.getUTCMinutes() + 15);
            }
            
            return slots;
        }

        function getAllSpaces() {
            const allSpaces = [];
            venues.forEach(venue => {
                venue.spaces.forEach(space => {
                    allSpaces.push({ ...space, venueId: venue.id, venueName: venue.name });
                });
            });
            return allSpaces;
        }

        function extractDropInfo(target) {
            if (agendaViewMode === 'grid') {
				// Determine which container we're in
				const gridContainer = target.closest('#grid-container') || target.closest('#fullscreen-grid-container');
				if (!gridContainer) return null;
				
				const cells = Array.from(gridContainer.children);
				const cellIndex = cells.indexOf(target);
                
                if (cellIndex === -1) return null;
                
                const spaces = selectedVenue ? selectedVenue.spaces : getAllSpaces();
                const cols = spaces.length + 1;
                const row = Math.floor(cellIndex / cols);
                const col = cellIndex % cols;
                
                if (col === 0 || row === 0) return null;
                
                const eventDays = agendaTimeMode === 'single' 
                    ? eventConfig.dailySchedules.filter(day => day.isEventDay && day.date === selectedAgendaDate)
                    : eventConfig.dailySchedules.filter(day => day.isEventDay);
                
                if (eventDays.length === 0) return null;
                
                const timeSlots = generateTimeSlots(eventDays[0]);
                const timeSlot = timeSlots[row - 1];
                const space = spaces[col - 1];
                
                return {
                    date: eventDays[0].date,
                    time: timeSlot,
                    space: space,
                    venue: venues.find(v => v.id === space.venueId) || selectedVenue
                };
            }
            
            return null;
        }

        function showDragPreview(startCell, slotsNeeded) {
            if (agendaViewMode !== 'grid') return;
            
            // Determine which container we're in
			const gridContainer = startCell.closest('#grid-container') || startCell.closest('#fullscreen-grid-container');
			if (!gridContainer) return;
			
			const cells = Array.from(gridContainer.children);
			const startIndex = cells.indexOf(startCell);
            
            if (startIndex === -1) return;
            
            const spaces = selectedVenue ? selectedVenue.spaces : getAllSpaces();
            const cols = spaces.length + 1;
            const startRow = Math.floor(startIndex / cols);
            const startCol = startIndex % cols;
            
            if (startCol === 0 || startRow === 0) return;
            
            startCell.classList.add('drop-target');
            dragPreviewCells.push(startCell);
            
            for (let i = 1; i < slotsNeeded; i++) {
                const nextRowIndex = (startRow + i) * cols + startCol;
                if (nextRowIndex < cells.length) {
                    const nextCell = cells[nextRowIndex];
                    if (nextCell && nextCell.classList.contains('grid-cell') && !nextCell.classList.contains('occupied')) {
                        nextCell.classList.add('drop-preview');
                        dragPreviewCells.push(nextCell);
                    } else if (nextCell && nextCell.classList.contains('occupied')) {
                        // Mark as invalid if occupied
                        startCell.classList.remove('drop-target');
                        startCell.classList.add('drop-invalid');
                        break;
                    }
                }
            }
        }

        function clearDragPreview() {
            dragPreviewCells.forEach(cell => {
                cell.classList.remove('drop-target', 'drop-preview', 'drop-invalid');
            });
            dragPreviewCells = [];
        }

        // View management
        function switchToExperiencesView() {
            currentView = 'experiences';
            document.getElementById('experiences-grid').style.display = 'grid';
            document.getElementById('agenda-container').classList.remove('active');
            document.getElementById('experiencesViewBtn').classList.add('active');
            document.getElementById('agendaViewBtn').classList.remove('active');
            updatePanelTitle();
        }

        function switchToAgendaView() {
            currentView = 'agenda';
            document.getElementById('experiences-grid').style.display = 'none';
            document.getElementById('agenda-container').classList.add('active');
            document.getElementById('agendaViewBtn').classList.add('active');
            document.getElementById('experiencesViewBtn').classList.remove('active');
            populateAgendaDaySelector();
            renderAgendaView();
            updatePanelTitle();
        }

        function setAgendaViewMode(mode) {
            agendaViewMode = mode;
            document.getElementById('gridViewBtn').classList.toggle('active', mode === 'grid');
            document.getElementById('listViewBtn').classList.toggle('active', mode === 'list');
            document.getElementById('agenda-grid').classList.toggle('active', mode === 'grid');
            document.getElementById('agenda-list').classList.toggle('active', mode === 'list');
            renderAgendaView();
        }

        function setAgendaTimeMode(mode) {
            agendaTimeMode = mode;
            document.getElementById('multidayBtn').classList.toggle('active', mode === 'multiday');
            document.getElementById('singledayBtn').classList.toggle('active', mode === 'single');
            document.getElementById('dateSelector').style.display = mode === 'single' ? 'flex' : 'none';
            
            if (mode === 'single' && !selectedAgendaDate) {
                const eventDays = eventConfig.dailySchedules.filter(day => day.isEventDay);
                if (eventDays.length > 0) {
                    selectedAgendaDate = eventDays[0].date;
                }
            }
            
            renderAgendaView();
        }

        function setSidebarMode(mode) {
            sidebarMode = mode;
            document.getElementById('venuesToggle').classList.toggle('active', mode === 'venues');
            document.getElementById('experiencesToggle').classList.toggle('active', mode === 'experiences');
            document.getElementById('venues-panel').classList.toggle('active', mode === 'venues');
            document.getElementById('experiences-panel').classList.toggle('active', mode === 'experiences');
            document.getElementById('addButtonText').textContent = mode === 'venues' ? 'Venue' : 'Experience';
            
            if (mode === 'experiences') {
                populateSidebarExperiences();
            }
        }

        function updatePanelTitle() {
            const titleElement = document.getElementById('panel-title');
            if (currentView === 'agenda') {
                if (selectedVenue) {
                    titleElement.textContent = `${selectedVenue.name} - Event Schedule`;
                } else {
                    titleElement.textContent = `${eventConfig.eventName} - Full Schedule`;
                }
            } else {
                if (selectedVenue) {
                    titleElement.textContent = `${selectedVenue.name} - Space Management`;
                } else {
                    titleElement.textContent = 'XR Experience Catalog';
                }
            }
        }

        function updateHeaderDisplay() {
            document.getElementById('appTitle').textContent = appSettings.appTitle;
            document.title = appSettings.appTitle;
            
            const headerIcon = document.getElementById('headerIcon');
            if (appSettings.appLogo) {
                headerIcon.innerHTML = `<img src="${appSettings.appLogo}" alt="Logo">`;
                headerIcon.className = 'header-icon custom';
            } else {
                headerIcon.innerHTML = '🎮';
                headerIcon.className = 'header-icon default';
            }
        }

        // Settings modal functions
        function openSettingsModal() {
            document.getElementById('appTitleInput').value = appSettings.appTitle;
            document.getElementById('defaultDuration').value = appSettings.defaultDuration;
            
            // Populate event configuration
            document.getElementById('eventName').value = eventConfig.eventName;
            document.getElementById('eventStartDate').value = eventConfig.startDate;
            document.getElementById('eventEndDate').value = eventConfig.endDate;
            document.getElementById('eventTimeZone').value = eventConfig.timeZone;
            document.getElementById('defaultBufferTime').value = eventConfig.defaultBufferTime;
            
            updateLogoPreview();
            renderOptionsLists();
            renderDailySchedules();
            document.getElementById('settingsModal').style.display = 'block';
            
            // Expand hardware section by default
            setTimeout(() => {
                const hardwareSection = document.getElementById('hardwareSection');
                const hardwareContent = hardwareSection.querySelector('.collapsible-content');
                const hardwareArrow = hardwareSection.querySelector('.collapsible-arrow');
                hardwareContent.style.maxHeight = hardwareContent.scrollHeight + 'px';
                hardwareArrow.style.transform = 'rotate(180deg)';
            }, 100);
        }

        function closeSettingsModal() {
            document.getElementById('settingsModal').style.display = 'none';
        }

        function updateLogoPreview() {
            const logoPreview = document.getElementById('logoPreview');
            const logoStatus = document.getElementById('logoStatus');
            
            if (appSettings.appLogo) {
                logoPreview.innerHTML = `<img src="${appSettings.appLogo}" alt="Logo">`;
                logoPreview.className = 'logo-preview custom';
                logoStatus.textContent = 'Custom logo uploaded';
            } else {
                logoPreview.innerHTML = '🎮';
                logoPreview.className = 'logo-preview default';
                logoStatus.textContent = 'Default icon';
            }
        }

        function handleLogoUpload(event) {
            const file = event.target.files[0];
            if (!file) return;

            // Validate file type
            const validTypes = ['image/jpeg', 'image/jpg', 'image/png', 'image/gif', 'image/svg+xml', 'image/webp'];
            if (!validTypes.includes(file.type)) {
                alert('Please upload a valid image file (JPG, PNG, GIF, SVG, or WebP)');
                event.target.value = '';
                return;
            }

            // Validate file size (max 5MB)
            if (file.size > 5 * 1024 * 1024) {
                alert('Please upload an image smaller than 5MB');
                event.target.value = '';
                return;
            }

            const reader = new FileReader();
            reader.onload = function(e) {
                // For SVG files, use directly without processing
                if (file.type === 'image/svg+xml') {
                    appSettings.appLogo = e.target.result;
                    updateLogoPreview();
                    updateHeaderDisplay();
                    return;
                }

                const img = new Image();
                img.onload = function() {
                    // Create ultra-high resolution canvas for maximum quality
                    const canvas = document.createElement('canvas');
                    const ctx = canvas.getContext('2d');
                    
                    // Use original size up to 512px max for ultra-crisp quality
                    let { width, height } = img;
                    const maxSize = 512;
                    
                    if (width > maxSize || height > maxSize) {
                        if (width > height) {
                            height = (height * maxSize) / width;
                            width = maxSize;
                        } else {
                            width = (width * maxSize) / height;
                            height = maxSize;
                        }
                    }
                    
                    canvas.width = width;
                    canvas.height = height;
                    
                    // Enable the highest quality rendering possible
                    ctx.imageSmoothingEnabled = false; // Disable smoothing for crisp pixels
                    ctx.globalCompositeOperation = 'source-over';
                    
                    // Draw image at full quality
                    ctx.drawImage(img, 0, 0, width, height);
                    
                    // Convert to data URL with maximum quality (no compression)
                    appSettings.appLogo = canvas.toDataURL('image/png', 1.0);
                    updateLogoPreview();
                    updateHeaderDisplay();
                };
                img.src = e.target.result;
            };
            reader.readAsDataURL(file);
        }

        function removeLogo() {
            appSettings.appLogo = null;
            document.getElementById('logoUpload').value = '';
            updateLogoPreview();
            updateHeaderDisplay();
        }

        function saveSettings() {
            appSettings.appTitle = document.getElementById('appTitleInput').value.trim() || '4E Event Planner';
            appSettings.defaultDuration = parseInt(document.getElementById('defaultDuration').value);
            
            // Save event configuration
            eventConfig.eventName = document.getElementById('eventName').value.trim() || 'XR Innovation Expo 2024';
            eventConfig.startDate = document.getElementById('eventStartDate').value;
            eventConfig.endDate = document.getElementById('eventEndDate').value;
            eventConfig.timeZone = document.getElementById('eventTimeZone').value;
            eventConfig.defaultBufferTime = parseInt(document.getElementById('defaultBufferTime').value);
            
            // Update daily schedules from form
            updateDailySchedulesFromForm();
            
            // Save to Firebase
            saveToFirebase('appSettings', appSettings);
            saveToFirebase('eventConfig', eventConfig);
            
            updateHeaderDisplay();
            closeSettingsModal();
        }

        function resetToDefaults() {
            if (confirm('Are you sure you want to reset all settings to defaults? This cannot be undone.')) {
                appSettings = JSON.parse(JSON.stringify(defaultSettings));
                eventConfig = JSON.parse(JSON.stringify(defaultEventConfig));
                
                document.getElementById('appTitleInput').value = appSettings.appTitle;
                document.getElementById('defaultDuration').value = appSettings.defaultDuration;
                document.getElementById('logoUpload').value = '';
                
                // Reset event configuration fields
                document.getElementById('eventName').value = eventConfig.eventName;
                document.getElementById('eventStartDate').value = eventConfig.startDate;
                document.getElementById('eventEndDate').value = eventConfig.endDate;
                document.getElementById('eventTimeZone').value = eventConfig.timeZone;
                document.getElementById('defaultBufferTime').value = eventConfig.defaultBufferTime;
                
                updateLogoPreview();
                updateHeaderDisplay();
                renderOptionsLists();
                renderDailySchedules();
            }
        }

        // Collapsible section functionality
        function toggleCollapsible(sectionId) {
            const section = document.getElementById(sectionId);
            const content = section.querySelector('.collapsible-content');
            const arrow = section.querySelector('.collapsible-arrow');
            
            const isExpanded = content.style.maxHeight && content.style.maxHeight !== '0px';
            
            if (isExpanded) {
                content.style.maxHeight = '0px';
                arrow.style.transform = 'rotate(0deg)';
            } else {
                content.style.maxHeight = content.scrollHeight + 'px';
                arrow.style.transform = 'rotate(180deg)';
            }
        }

        function renderOptionsLists() {
            renderOptionsList('hardwareList', appSettings.hardwareOptions, 'hardware');
            renderOptionsList('softwareList', appSettings.softwareOptions, 'software');
            renderOptionsList('spaceList', appSettings.spaceOptions, 'space');
        }

        function renderOptionsList(containerId, options, type) {
            const container = document.getElementById(containerId);
            container.innerHTML = '';
            
            options.forEach((option, index) => {
                const optionDiv = document.createElement('div');
                optionDiv.className = 'option-item';
                optionDiv.innerHTML = `
                    <span class="option-text">${option}</span>
                    <button class="option-remove" onclick="removeOption('${type}', ${index})">Remove</button>
                `;
                container.appendChild(optionDiv);
            });
        }

        function addHardwareOption() {
            const input = document.getElementById('newHardware');
            const value = input.value.trim();
            if (value && !appSettings.hardwareOptions.includes(value)) {
                appSettings.hardwareOptions.push(value);
                input.value = '';
                renderOptionsLists();
                updateCollapsibleHeight('hardwareSection');
            }
        }

        function addSoftwareOption() {
            const input = document.getElementById('newSoftware');
            const value = input.value.trim();
            if (value && !appSettings.softwareOptions.includes(value)) {
                appSettings.softwareOptions.push(value);
                input.value = '';
                renderOptionsLists();
                updateCollapsibleHeight('softwareSection');
            }
        }

        function addSpaceOption() {
            const input = document.getElementById('newSpace');
            const value = input.value.trim();
            if (value && !appSettings.spaceOptions.includes(value)) {
                appSettings.spaceOptions.push(value);
                input.value = '';
                renderOptionsLists();
                updateCollapsibleHeight('spaceSection');
            }
        }

        function removeOption(type, index) {
            const optionsKey = type + 'Options';
            if (appSettings[optionsKey] && appSettings[optionsKey].length > 1) {
                appSettings[optionsKey].splice(index, 1);
                renderOptionsLists();
                updateCollapsibleHeight(type + 'Section');
            }
        }

        function updateCollapsibleHeight(sectionId) {
            const section = document.getElementById(sectionId);
            const content = section.querySelector('.collapsible-content');
            if (content.style.maxHeight && content.style.maxHeight !== '0px') {
                setTimeout(() => {
                    content.style.maxHeight = content.scrollHeight + 'px';
                }, 10);
            }
        }

        // Daily schedule management
        function renderDailySchedules() {
            const container = document.getElementById('dailySchedulesList');
            container.innerHTML = '';
            
            // Generate schedules based on date range if needed
            if (eventConfig.startDate && eventConfig.endDate) {
                generateDailySchedules();
            }
            
            eventConfig.dailySchedules.forEach((schedule, index) => {
                const scheduleDiv = document.createElement('div');
                scheduleDiv.className = 'daily-schedule-item';
                
                const dateObj = new Date(schedule.date + 'T12:00:00'); // Use noon to avoid timezone issues
                const dayName = dateObj.toLocaleDateString('en-US', { weekday: 'short' });
                const dateFormatted = dateObj.toLocaleDateString('en-US', { month: 'short', day: 'numeric' });
                
                scheduleDiv.innerHTML = `
                    <div class="schedule-date">${dayName}<br>${dateFormatted}</div>
                    <div class="schedule-times">
                        <input type="time" class="schedule-time-input" id="startTime_${index}" 
                               value="${schedule.startTime}" onchange="updateScheduleTime(${index}, 'startTime', this.value)"
                               title="${formatTime12Hour(schedule.startTime)}">
                        <span style="color: #94a3b8;">to</span>
                        <input type="time" class="schedule-time-input" id="endTime_${index}" 
                               value="${schedule.endTime}" onchange="updateScheduleTime(${index}, 'endTime', this.value)"
                               title="${formatTime12Hour(schedule.endTime)}">
                    </div>
                    <div class="schedule-toggle">
                        <input type="checkbox" id="isEventDay_${index}" 
                               ${schedule.isEventDay ? 'checked' : ''} 
                               onchange="updateScheduleEventDay(${index}, this.checked)">
                        <label for="isEventDay_${index}">Event Day</label>
                    </div>
                `;
                
                container.appendChild(scheduleDiv);
            });
            
            // Add time format labels
            if (eventConfig.dailySchedules.length > 0) {
                const helpText = document.createElement('div');
                helpText.style.cssText = 'color: #6b7280; font-size: 0.75rem; margin-top: 8px; text-align: center;';
                helpText.textContent = 'Times are displayed in 24-hour format. Hover over time inputs to see 12-hour format.';
                container.appendChild(helpText);
            }
        }

        function generateDailySchedules() {
            const startDate = new Date(eventConfig.startDate + 'T12:00:00'); // Use noon to avoid timezone issues
            const endDate = new Date(eventConfig.endDate + 'T12:00:00');
            const newSchedules = [];
            
            for (let date = new Date(startDate); date <= endDate; date.setUTCDate(date.getUTCDate() + 1)) {
                const dateStr = date.toISOString().split('T')[0];
                
                // Check if schedule already exists
                let existingSchedule = eventConfig.dailySchedules.find(s => s.date === dateStr);
                
                if (existingSchedule) {
                    newSchedules.push(existingSchedule);
                } else {
                    // Create new schedule with default times
                    newSchedules.push({
                        date: dateStr,
                        startTime: '09:00',
                        endTime: '18:00',
                        isEventDay: true
                    });
                }
            }
            
            eventConfig.dailySchedules = newSchedules;
        }

        function updateScheduleTime(index, field, value) {
            if (eventConfig.dailySchedules[index]) {
                eventConfig.dailySchedules[index][field] = value;
            }
        }

        function updateScheduleEventDay(index, isEventDay) {
            if (eventConfig.dailySchedules[index]) {
                eventConfig.dailySchedules[index].isEventDay = isEventDay;
            }
        }

        function updateDailySchedulesFromForm() {
            // This function is called when saving settings
            // The daily schedules are already updated through the onchange events
            // But we can add validation here if needed
            
            // Validate that start time is before end time for each day
            eventConfig.dailySchedules.forEach(schedule => {
                if (schedule.startTime >= schedule.endTime) {
                    alert(`Warning: Start time should be before end time for ${schedule.date}`);
                }
            });
        }

        // Experience modal functions
        function openExperienceModal() {
            if (!editingExperience) {
                document.getElementById('experienceModalTitle').textContent = 'Add New Experience';
                document.getElementById('experienceName').value = '';
                document.getElementById('experienceType').value = 'VR';
                document.getElementById('experienceDuration').value = appSettings.defaultDuration;
                document.getElementById('experienceDescription').value = '';
            }
            
            generateCheckboxes(document.getElementById('hardwareSelect'), appSettings.hardwareOptions, editingExperience ? editingExperience.hardware : []);
            generateCheckboxes(document.getElementById('softwareSelect'), appSettings.softwareOptions, editingExperience ? editingExperience.software : []);
            generateCheckboxes(document.getElementById('spaceSelect'), appSettings.spaceOptions, editingExperience ? editingExperience.space : []);
            
            document.getElementById('experienceModal').style.display = 'block';
        }

        function closeExperienceModal() {
            document.getElementById('experienceModal').style.display = 'none';
            editingExperience = null;
        }

        function saveExperience() {
            const experienceData = {
                name: document.getElementById('experienceName').value,
                type: document.getElementById('experienceType').value,
                duration: parseInt(document.getElementById('experienceDuration').value),
                description: document.getElementById('experienceDescription').value,
                hardware: getSelectedCheckboxes(document.getElementById('hardwareSelect')),
                software: getSelectedCheckboxes(document.getElementById('softwareSelect')),
                space: getSelectedCheckboxes(document.getElementById('spaceSelect'))
            };

            if (!experienceData.name || !experienceData.description) {
                alert('Please fill in all required fields');
                return;
            }

            if (editingExperience) {
                Object.assign(editingExperience, experienceData);
            } else {
                const newExperience = {
                    id: experiences.length > 0 ? Math.max(...experiences.map(e => e.id)) + 1 : 1,
                    ...experienceData
                };
                experiences.push(newExperience);
            }

            // Save to Firebase
            saveToFirebase('experiences', experiences);

            renderExperiences();
            if (sidebarMode === 'experiences') {
                populateSidebarExperiences();
            }
            closeExperienceModal();
        }

        function editExperience(experienceId) {
            editingExperience = experiences.find(exp => exp.id === experienceId);
            if (!editingExperience) return;

            document.getElementById('experienceModalTitle').textContent = 'Edit Experience';
            document.getElementById('experienceName').value = editingExperience.name;
            document.getElementById('experienceType').value = editingExperience.type;
            document.getElementById('experienceDuration').value = editingExperience.duration;
            document.getElementById('experienceDescription').value = editingExperience.description;

            openExperienceModal();
        }

        function deleteExperience(experienceId) {
            if (confirm('Are you sure you want to delete this experience? All scheduled sessions will also be removed.')) {
                // Remove all sessions for this experience
                scheduledSessions = scheduledSessions.filter(s => s.experienceId !== experienceId);
                
                // Remove the experience
                experiences = experiences.filter(e => e.id !== experienceId);
                
                // Save to Firebase
                saveToFirebase('experiences', experiences);
                saveToFirebase('scheduledSessions', scheduledSessions);
                
                renderExperiences();
                if (sidebarMode === 'experiences') {
                    populateSidebarExperiences();
                }
            }
        }

        // Venue modal functions
        function openVenueModal() {
            if (!editingVenue) {
                document.getElementById('venueModalTitle').textContent = 'Add New Venue';
                document.getElementById('venueName').value = '';
                document.getElementById('venueCapacity').value = '';
                document.getElementById('venueArea').value = '';
                document.getElementById('venueLocation').value = '';
                document.getElementById('venueDescription').value = '';
                window.tempVenueSpaces = [];
            } else {
                document.getElementById('venueModalTitle').textContent = 'Edit Venue';
                document.getElementById('venueName').value = editingVenue.name;
                document.getElementById('venueCapacity').value = editingVenue.capacity;
                document.getElementById('venueArea').value = editingVenue.area;
                document.getElementById('venueLocation').value = editingVenue.location;
                document.getElementById('venueDescription').value = editingVenue.description || '';
                window.tempVenueSpaces = [];
            }
            
            renderVenueSpaces();
            document.getElementById('venueModal').style.display = 'block';
        }

        function closeVenueModal() {
            document.getElementById('venueModal').style.display = 'none';
            hideSpaceForm();
            editingVenue = null;
            editingSpace = null;
            window.tempVenueSpaces = [];
        }

        function saveVenue() {
            const venueData = {
                name: document.getElementById('venueName').value,
                capacity: parseInt(document.getElementById('venueCapacity').value),
                area: parseInt(document.getElementById('venueArea').value),
                location: document.getElementById('venueLocation').value,
                description: document.getElementById('venueDescription').value
            };

            if (!venueData.name || !venueData.capacity || !venueData.area || !venueData.location) {
                alert('Please fill in all required fields');
                return;
            }

            if (editingVenue) {
                Object.assign(editingVenue, venueData);
            } else {
                const newVenue = {
                    id: venues.length > 0 ? Math.max(...venues.map(v => v.id)) + 1 : 1,
                    ...venueData,
                    spaces: window.tempVenueSpaces.length > 0 ? window.tempVenueSpaces : [
                        { 
                            id: 1, 
                            name: "Main Space", 
                            capacity: venueData.capacity, 
                            area: venueData.area,
                            description: "Primary area"
                        }
                    ]
                };
                venues.push(newVenue);
            }

            // Save to Firebase
            saveToFirebase('venues', venues);

            renderVenues();
            closeVenueModal();
        }

        function editVenue(venueId) {
            editingVenue = venues.find(v => v.id === venueId);
            if (!editingVenue) return;
            openVenueModal();
        }

        function deleteVenue(venueId) {
            if (confirm('Are you sure you want to delete this venue? All scheduled sessions in this venue will also be removed.')) {
                // Remove all sessions for this venue
                scheduledSessions = scheduledSessions.filter(s => s.venueId !== venueId);
                
                // Remove the venue
                venues = venues.filter(v => v.id !== venueId);
                
                if (selectedVenue?.id === venueId) {
                    selectedVenue = null;
                }
                
                // Save to Firebase
                saveToFirebase('venues', venues);
                saveToFirebase('scheduledSessions', scheduledSessions);
                
                renderVenues();
                if (currentView === 'agenda') {
                    renderAgendaView();
                }
            }
        }

        // Space management functions
        function showSpaceForm() {
            document.getElementById('spaceForm').style.display = 'block';
            document.getElementById('spaceFormTitle').textContent = editingSpace ? 'Edit Space' : 'Add New Space';
            document.getElementById('spaceSubmitText').textContent = editingSpace ? 'Update Space' : 'Add Space';
            
            if (editingSpace) {
                document.getElementById('spaceName').value = editingSpace.name;
                document.getElementById('spaceCapacity').value = editingSpace.capacity;
                document.getElementById('spaceArea').value = editingSpace.area;
                document.getElementById('spaceDescription').value = editingSpace.description || '';
            }
        }

        function hideSpaceForm() {
            document.getElementById('spaceForm').style.display = 'none';
            document.getElementById('spaceName').value = '';
            document.getElementById('spaceCapacity').value = '';
            document.getElementById('spaceArea').value = '';
            document.getElementById('spaceDescription').value = '';
            editingSpace = null;
        }

        function saveSpace() {
            const name = document.getElementById('spaceName').value.trim();
            const capacity = parseInt(document.getElementById('spaceCapacity').value);
            const area = parseInt(document.getElementById('spaceArea').value);
            const description = document.getElementById('spaceDescription').value.trim();

            if (!name || !capacity || !area) {
                alert('Please fill in all required space fields');
                return;
            }

            const spaceData = { name, capacity, area, description };

            if (editingSpace) {
                // Update existing space
                Object.assign(editingSpace, spaceData);
            } else {
                // Add new space
                const currentSpaces = editingVenue ? editingVenue.spaces : (window.tempVenueSpaces || []);
                const newSpaceId = currentSpaces.length > 0 ? Math.max(...currentSpaces.map(s => s.id)) + 1 : 1;
                
                spaceData.id = newSpaceId;
                
                if (editingVenue) {
                    editingVenue.spaces.push(spaceData);
                } else {
                    if (!window.tempVenueSpaces) window.tempVenueSpaces = [];
                    window.tempVenueSpaces.push(spaceData);
                }
            }

            hideSpaceForm();
            renderVenueSpaces();
            
            if (editingVenue) {
                saveToFirebase('venues', venues);
                renderVenues();
            }
        }

        function renderVenueSpaces() {
            const spacesList = document.getElementById('venueSpacesList');
            const spaces = editingVenue ? editingVenue.spaces : (window.tempVenueSpaces || []);
            
            spacesList.innerHTML = '';
            
            spaces.forEach(space => {
                const spaceDiv = document.createElement('div');
                spaceDiv.className = 'space-item';
                spaceDiv.innerHTML = `
                    <div class="space-header">
                        <span class="space-name">${space.name}</span>
                        <div class="space-actions">
                            <button class="space-btn" onclick="event.stopPropagation(); event.preventDefault(); editSpaceInModal(${space.id})" title="Edit Space">✏️</button>
                            <button class="space-btn delete" onclick="event.stopPropagation(); event.preventDefault(); deleteSpaceInModal(${space.id})" title="Delete Space">🗑️</button>
                        </div>
                    </div>
                    <div class="space-info">${space.capacity} people • ${space.area} sqm</div>
                    <div class="space-description">${space.description || ''}</div>
                `;
                spacesList.appendChild(spaceDiv);
            });
        }

        function editSpaceInModal(spaceId) {
            const spaces = editingVenue ? editingVenue.spaces : (window.tempVenueSpaces || []);
            editingSpace = spaces.find(s => s.id === spaceId);
            if (!editingSpace) return;
            showSpaceForm();
        }

        function deleteSpaceInModal(spaceId) {
            if (confirm('Are you sure you want to delete this space?')) {
                if (editingVenue) {
                    // Remove sessions in this space
                    scheduledSessions = scheduledSessions.filter(s => 
                        !(s.venueId === editingVenue.id && s.spaceId === spaceId)
                    );
                    
                    editingVenue.spaces = editingVenue.spaces.filter(s => s.id !== spaceId);
                    saveToFirebase('venues', venues);
                    saveToFirebase('scheduledSessions', scheduledSessions);
                } else {
                    window.tempVenueSpaces = (window.tempVenueSpaces || []).filter(s => s.id !== spaceId);
                }
                renderVenueSpaces();
            }
        }

        function editSpace(venueId, spaceId) {
            const venue = venues.find(v => v.id === venueId);
            if (!venue) return;
            
            editingVenue = venue;
            editingSpace = venue.spaces.find(s => s.id === spaceId);
            if (!editingSpace) return;
            
            openVenueModal();
            setTimeout(() => {
                showSpaceForm();
            }, 100);
        }

        function deleteSpace(venueId, spaceId) {
            const venue = venues.find(v => v.id === venueId);
            if (!venue) return;

            if (confirm('Are you sure you want to delete this space? All scheduled sessions in this space will be removed.')) {
                // Remove sessions in this space
                scheduledSessions = scheduledSessions.filter(s => 
                    !(s.venueId === venueId && s.spaceId === spaceId)
                );

                // Remove the space
                venue.spaces = venue.spaces.filter(s => s.id !== spaceId);
                
                // Save to Firebase
                saveToFirebase('venues', venues);
                saveToFirebase('scheduledSessions', scheduledSessions);
                
                renderVenues();
                if (currentView === 'agenda') {
                    renderAgendaView();
                }
            }
        }

        // Checkbox utility functions
        function generateCheckboxes(container, options, selectedValues = []) {
            container.innerHTML = '';
            options.forEach(option => {
                const item = document.createElement('div');
                item.className = 'multi-select-item';
                item.innerHTML = `
                    <input type="checkbox" id="${option.replace(/\s+/g, '_')}" value="${option}" 
                           ${selectedValues.includes(option) ? 'checked' : ''}>
                    <label for="${option.replace(/\s+/g, '_')}">${option}</label>
                `;
                container.appendChild(item);
            });
        }

        function getSelectedCheckboxes(container) {
            const checkboxes = container.querySelectorAll('input[type="checkbox"]:checked');
            return Array.from(checkboxes).map(cb => cb.value);
        }

        // Rendering functions
        function renderVenues() {
            const venuesContainer = document.getElementById('venues-list');
            venuesContainer.innerHTML = '';

            venues.forEach(venue => {
                const venueCard = document.createElement('div');
                venueCard.className = `venue-card ${selectedVenue?.id === venue.id ? 'active' : ''}`;

                venueCard.innerHTML = `
                    <div class="venue-header">
                        <h3>${venue.name}</h3>
                        <div class="venue-actions">
                            <button class="btn-icon" onclick="editVenue(${venue.id})" title="Edit Venue">✏️</button>
                            <button class="btn-icon" onclick="deleteVenue(${venue.id})" title="Delete Venue">🗑️</button>
                        </div>
                    </div>
                    <div class="venue-info">
                        <div class="venue-detail">
                            <div class="venue-detail-icon">👥</div>
                            <span>${venue.capacity} people</span>
                        </div>
                        <div class="venue-detail">
                            <div class="venue-detail-icon">📐</div>
                            <span>${venue.area} sqm</span>
                        </div>
                        <div class="venue-detail">
                            <div class="venue-detail-icon">📍</div>
                            <span>${venue.location}</span>
                        </div>
                        <div class="venue-detail">
                            <div class="venue-detail-icon">🏢</div>
                            <span>${venue.spaces.length} spaces</span>
                        </div>
                    </div>
                    ${selectedVenue?.id === venue.id ? `
                        <div class="spaces-section">
                            <div class="spaces-header">
                                <span style="color: #cbd5e1; font-size: 0.8rem; font-weight: 600;">SPACES</span>
                            </div>
                            <div style="max-height: 120px; overflow-y: auto;">
                                ${venue.spaces.slice(0, 3).map(space => `
                                    <div class="space-item">
                                        <div class="space-header">
                                            <span class="space-name">${space.name}</span>
                                            <div class="space-actions">
                                                <button class="space-btn" onclick="event.stopPropagation(); editSpace(${venue.id}, ${space.id})" title="Edit Space">✏️</button>
                                                <button class="space-btn delete" onclick="event.stopPropagation(); deleteSpace(${venue.id}, ${space.id})" title="Delete Space">🗑️</button>
                                            </div>
                                        </div>
                                        <div class="space-info">${space.capacity} people • ${space.area} sqm</div>
                                        <div class="space-description">${space.description || ''}</div>
                                    </div>
                                `).join('')}
                                ${venue.spaces.length > 3 ? `<div style="color: #64748b; font-size: 0.75rem; text-align: center; padding: 4px;">+${venue.spaces.length - 3} more spaces</div>` : ''}
                            </div>
                        </div>
                    ` : ''}
                `;

                venueCard.addEventListener('click', (e) => {
                    if (!e.target.closest('.venue-actions') && !e.target.closest('.space-actions') && !e.target.closest('.space-btn')) {
                        selectVenue(venue);
                    }
                });

                venuesContainer.appendChild(venueCard);
            });
        }

        function renderExperiences() {
            const experiencesContainer = document.getElementById('experiences-grid');
            experiencesContainer.innerHTML = '';

            experiences.forEach(experience => {
                const experienceCard = document.createElement('div');
                experienceCard.className = 'experience-card';

                const typeClass = `type-${experience.type.toLowerCase()}`;

                experienceCard.innerHTML = `
                    <div class="experience-header">
                        <div>
                            <h3 class="experience-title">${experience.name}</h3>
                            <div style="color: #94a3b8; font-size: 0.9rem; margin-top: 4px;">
                                Duration: ${experience.duration} minutes
                            </div>
                        </div>
                        <span class="experience-type ${typeClass}">${experience.type}</span>
                    </div>
                    <p class="experience-description">${experience.description}</p>
                    
                    <div class="requirements">
                        <h4>Hardware</h4>
                        <div class="requirement-tags">
                            ${experience.hardware.map(req => `<span class="requirement-tag">${req}</span>`).join('')}
                        </div>
                    </div>
                    
                    <div class="requirements">
                        <h4>Software</h4>
                        <div class="requirement-tags">
                            ${experience.software.map(req => `<span class="requirement-tag">${req}</span>`).join('')}
                        </div>
                    </div>
                    
                    <div class="requirements">
                        <h4>Space</h4>
                        <div class="requirement-tags">
                            ${experience.space.map(req => `<span class="requirement-tag">${req}</span>`).join('')}
                        </div>
                    </div>
                    
                    <div class="experience-actions" style="margin-top: 16px;">
                        <button class="btn-edit" onclick="editExperience(${experience.id})">Edit</button>
                        <button class="btn-delete" onclick="deleteExperience(${experience.id})">Delete</button>
                    </div>
                `;

                experiencesContainer.appendChild(experienceCard);
            });
        }

        function renderAgendaView() {
            if (agendaViewMode === 'grid') {
                renderAgendaGrid();
            } else {
                renderAgendaList();
            }
        }

        function renderAgendaGrid() {
            const gridContainer = document.getElementById('grid-container');
            
            const eventDays = agendaTimeMode === 'single' 
                ? eventConfig.dailySchedules.filter(day => day.isEventDay && day.date === selectedAgendaDate)
                : eventConfig.dailySchedules.filter(day => day.isEventDay);
            
            if (eventDays.length === 0) {
                gridContainer.innerHTML = '<div style="grid-column: 1/-1; padding: 40px; text-align: center; color: #6b7280;">No event days configured.</div>';
                return;
            }

            const spaces = selectedVenue ? selectedVenue.spaces : getAllSpaces();
            
            if (spaces.length === 0) {
                gridContainer.innerHTML = '<div style="grid-column: 1/-1; padding: 40px; text-align: center; color: #6b7280;">No spaces available.</div>';
                return;
            }

            const dayToShow = eventDays[0];
            const timeSlots = generateTimeSlots(dayToShow);
            
            gridContainer.style.setProperty('--spaces-count', spaces.length);
            gridContainer.style.setProperty('--time-slots', timeSlots.length);
            
            gridContainer.innerHTML = '';
            
            // Header row
            const timeHeaderCell = document.createElement('div');
            timeHeaderCell.className = 'grid-header';
            timeHeaderCell.textContent = 'Time';
            gridContainer.appendChild(timeHeaderCell);
            
            spaces.forEach(space => {
                const spaceHeaderCell = document.createElement('div');
                spaceHeaderCell.className = 'grid-header';
                spaceHeaderCell.innerHTML = `<strong>${space.name}</strong><br><small>${space.capacity} people</small>`;
                gridContainer.appendChild(spaceHeaderCell);
            });
            
            // Time slot rows
            timeSlots.forEach(timeSlot => {
                const timeCell = document.createElement('div');
                timeCell.className = 'grid-time';
                timeCell.textContent = formatTime12Hour(timeSlot);
                gridContainer.appendChild(timeCell);
                
                spaces.forEach(space => {
                    const cell = document.createElement('div');
                    cell.className = 'grid-cell';
                    
                    const session = findSessionInSlot(selectedVenue?.id || space.venueId, space.id, dayToShow.date, timeSlot);
                    if (session) {
                        const slotsSpanned = calculateSessionSlots(session);
                        const sessionStartIndex = timeSlots.indexOf(session.startTime);
                        const currentSlotIndex = timeSlots.indexOf(timeSlot);
                        
                        if (sessionStartIndex === currentSlotIndex) {
                            cell.classList.add('occupied');
                            const cellHeight = slotsSpanned * 40 - 2;
                            
                            cell.innerHTML = `
                                <div class="experience-session ${session.experienceType.toLowerCase()} multi-slot" 
                                     style="height: ${cellHeight}px;"
                                     data-session-id="${session.id}"
                                     title="${session.experienceName}"
                                     onmousedown="startSessionDrag(event, ${session.id})">
                                    <div class="experience-session-content">
                                        <div class="session-main-title">${session.experienceName}</div>
                                        <div class="session-meta">${formatTime12Hour(session.startTime)} - ${formatTime12Hour(session.endTime)}<br>
                                        ${session.maxCapacity} people • ${session.spaceName}</div>
                                        
                                        <div class="session-actions">
                                            <div class="session-action-btn info" onclick="event.stopPropagation(); showSessionInfo(${session.id})" title="Session Info">ℹ️</div>
                                            <div class="session-action-btn delete" onclick="event.stopPropagation(); deleteSession(${session.id})" title="Delete Session">🗑️</div>
                                        </div>
                                        
                                        <div class="session-resize-handle" 
                                             onmousedown="startSessionResize(event, ${session.id})"
                                             title="Duplicate sessions by dragging down"></div>
                                    </div>
                                </div>
                            `;
                        } else if (currentSlotIndex > sessionStartIndex && currentSlotIndex < sessionStartIndex + slotsSpanned) {
                            cell.classList.add('occupied');
                        }
                    }
                    
                    cell.addEventListener('click', (cellEvent) => {
                        if (!session && !draggedExperience && !isDraggingSession) {
                            openScheduleModal(space, dayToShow.date, timeSlot);
                        }
                    });
                    
                    gridContainer.appendChild(cell);
                });
            });
        }

        function findSessionInSlot(venueId, spaceId, date, timeSlot) {
            return scheduledSessions.find(session => 
                session.venueId === venueId && 
                session.spaceId === spaceId && 
                session.date === date && 
                session.startTime === timeSlot
            );
        }

        function renderAgendaList() {
            const listContainer = document.getElementById('agenda-list');
            
            const eventDays = agendaTimeMode === 'single' 
                ? eventConfig.dailySchedules.filter(day => day.isEventDay && day.date === selectedAgendaDate)
                : eventConfig.dailySchedules.filter(day => day.isEventDay);
            
            if (eventDays.length === 0) {
                listContainer.innerHTML = '<div style="padding: 40px; text-align: center; color: #6b7280;">No event days configured.</div>';
                return;
            }

            listContainer.innerHTML = '';
            
            eventDays.forEach(day => {
                const daySection = document.createElement('div');
                daySection.className = 'day-section';
                
                const date = new Date(day.date + 'T00:00:00');
                const dayName = date.toLocaleDateString('en-US', { weekday: 'long' });
                const dateFormatted = date.toLocaleDateString('en-US', { month: 'long', day: 'numeric', year: 'numeric' });
                
                const daySessions = scheduledSessions.filter(session => session.date === day.date);
                const venueFilter = selectedVenue ? daySessions.filter(session => session.venueId === selectedVenue.id) : daySessions;
                
                daySection.innerHTML = `
                    <div class="day-header">
                        <div class="day-title">${dayName}</div>
                        <div class="day-info">${dateFormatted} • ${day.startTime} - ${day.endTime} • ${venueFilter.length} sessions</div>
                    </div>
                    <div class="day-content" id="day-content-${day.date}">
                    </div>
                `;
                
                listContainer.appendChild(daySection);
                
                renderDayContent(day, venueFilter);
            });
        }

        function renderDayContent(day, sessions) {
            const dayContent = document.getElementById(`day-content-${day.date}`);
            const timeSlots = generateTimeSlots(day);
            
            timeSlots.forEach(timeSlot => {
                const slotSessions = sessions.filter(session => session.startTime === timeSlot);
                
                if (slotSessions.length === 0) return; // Skip empty slots
                
                const timeSlotDiv = document.createElement('div');
                timeSlotDiv.className = 'time-slot';
                
                timeSlotDiv.innerHTML = `
                    <div class="time-label">${formatTime12Hour(timeSlot)}</div>
                    <div class="experiences-in-slot">
                        ${slotSessions.map(session => `
                            <div class="experience-session ${session.experienceType.toLowerCase()}" style="cursor: pointer;">
                                <div class="session-info">
                                    <div class="session-title">${session.experienceName}</div>
                                    <div class="session-details">${session.spaceName} • ${session.maxCapacity} people • ${formatTime12Hour(session.startTime)}-${formatTime12Hour(session.endTime)}</div>
                                </div>
                            </div>
                        `).join('')}
                    </div>
                `;
                
                dayContent.appendChild(timeSlotDiv);
            });
            
            if (dayContent.innerHTML === '') {
                dayContent.innerHTML = '<div class="empty-slot" style="padding: 20px; text-align: center;">No sessions scheduled for this day</div>';
            }
        }

        // Additional utility functions
        function populateAgendaDaySelector() {
            const daySelect = document.getElementById('daySelect');
            daySelect.innerHTML = '';
            
            const eventDays = eventConfig.dailySchedules.filter(day => day.isEventDay);
            eventDays.forEach(day => {
                const option = document.createElement('option');
                option.value = day.date;
                
                const date = new Date(day.date + 'T00:00:00');
                const dayName = date.toLocaleDateString('en-US', { weekday: 'short' });
                const dateFormatted = date.toLocaleDateString('en-US', { month: 'short', day: 'numeric' });
                
                option.textContent = `${dayName} ${dateFormatted}`;
                daySelect.appendChild(option);
            });
            
            if (selectedAgendaDate) {
                daySelect.value = selectedAgendaDate;
            }
        }

        function setSelectedAgendaDate(date) {
            selectedAgendaDate = date;
            renderAgendaView();
        }

        function populateSidebarExperiences() {
            const container = document.getElementById('sidebar-draggable-experiences');
            container.innerHTML = '';
            
            if (experiences.length === 0) {
                container.innerHTML = '<div style="color: #6b7280; text-align: center; padding: 20px; font-size: 0.85rem;">No experiences available.<br>Create experiences first.</div>';
                return;
            }
            
            experiences.forEach(experience => {
                const expDiv = document.createElement('div');
                expDiv.className = 'draggable-experience';
                expDiv.draggable = true;
                expDiv.dataset.experienceId = experience.id;
                
                expDiv.innerHTML = `
                    <div class="experience-drag-info">
                        <div class="experience-drag-title">${experience.name}</div>
                        <div class="experience-drag-type ${experience.type.toLowerCase()}">${experience.type}</div>
                    </div>
                    <div class="experience-drag-details">
                        ${experience.duration}min • ${experience.hardware.slice(0, 2).join(', ')}${experience.hardware.length > 2 ? '...' : ''}
                    </div>
                `;
                
                expDiv.addEventListener('dragstart', handleDragStart);
                expDiv.addEventListener('dragend', handleDragEnd);
                
                container.appendChild(expDiv);
            });
        }

        // Drag & Drop Event Handlers
        function handleDragStart(e) {
            draggedExperience = experiences.find(exp => exp.id == e.target.dataset.experienceId);
            e.target.classList.add('dragging');
            e.dataTransfer.effectAllowed = 'copy';
            addDropZones();
        }

        function handleDragEnd(e) {
            e.target.classList.remove('dragging');
            draggedExperience = null;
            removeDropZones();
            clearDragPreview();
        }

        function addDropZones() {
			if (agendaViewMode === 'grid') {
				// Check if we're in fullscreen mode
				const isFullscreen = document.getElementById('fullscreenModal').classList.contains('active');
				const containerSelector = isFullscreen 
					? '#fullscreen-grid-container .grid-cell:not(.occupied)'
					: '#grid-container .grid-cell:not(.occupied)';
				
				const cells = document.querySelectorAll(containerSelector);
				cells.forEach(cell => {
					cell.addEventListener('dragover', handleDragOver);
					cell.addEventListener('dragleave', handleDragLeave);
					cell.addEventListener('drop', handleDrop);
				});
			}
		}

        function removeDropZones() {
            const dropTargets = document.querySelectorAll('.drop-target, .drop-invalid, .drop-preview');
            dropTargets.forEach(target => {
                target.classList.remove('drop-target', 'drop-invalid', 'drop-preview');
                target.removeEventListener('dragover', handleDragOver);
                target.removeEventListener('dragleave', handleDragLeave);
                target.removeEventListener('drop', handleDrop);
            });
        }
		
		// Add a helper function to get the current view mode
		function getCurrentViewMode() {
			const isFullscreen = document.getElementById('fullscreenModal').classList.contains('active');
			return isFullscreen ? fullscreenViewMode : agendaViewMode;
		}

        function handleDragOver(e) {
			e.preventDefault();
			e.dataTransfer.dropEffect = 'copy';
			
			if (!draggedExperience || isDraggingSession) return;
			
			clearDragPreview();
			const slotsNeeded = calculateSlotsNeeded(draggedExperience);
			showDragPreview(e.target, slotsNeeded);
		}

        function handleDragLeave(e) {
            if (!e.relatedTarget || !e.currentTarget.contains(e.relatedTarget)) {
                clearDragPreview();
            }
        }

        function handleDrop(e) {
            e.preventDefault();
            e.target.classList.remove('drop-target', 'drop-invalid');
            
            if (!draggedExperience || isDraggingSession) return;
            
            const dropInfo = extractDropInfo(e.target);
            if (!dropInfo) return;
            
            showQuickSchedulePopup(e.clientX, e.clientY, draggedExperience, dropInfo);
        }

        function showQuickSchedulePopup(x, y, experience, dropInfo) {
            if (!experience || !dropInfo) return;
            
            if (quickSchedulePopup) {
                quickSchedulePopup.remove();
            }
            
            quickSchedulePopup = document.createElement('div');
            quickSchedulePopup.className = 'quick-schedule-popup';
            
            const startDate = new Date(`1970-01-01T${dropInfo.time}:00Z`);
            startDate.setUTCMinutes(startDate.getUTCMinutes() + experience.duration + eventConfig.defaultBufferTime);
            const endTime = startDate.toISOString().substr(11, 5);
            
            quickSchedulePopup.innerHTML = `
                <div class="quick-schedule-header">Quick Schedule</div>
                <div class="quick-schedule-info">
                    <strong>${experience.name}</strong><br>
                    ${dropInfo.venue?.name} - ${dropInfo.space.name}<br>
                    ${dropInfo.date} • ${formatTime12Hour(dropInfo.time)} - ${formatTime12Hour(endTime)}<br>
                    Duration: ${experience.duration}min + ${eventConfig.defaultBufferTime}min buffer
                </div>
                <div class="quick-schedule-actions">
                    <button class="btn-quick btn-quick-secondary" onclick="closeQuickSchedulePopup()">Cancel</button>
                    <button class="btn-quick btn-quick-primary" onclick="confirmQuickSchedule()">Schedule</button>
                </div>
            `;
            
            quickSchedulePopup.style.left = Math.min(x, window.innerWidth - 420) + 'px';
            quickSchedulePopup.style.top = Math.min(y, window.innerHeight - 200) + 'px';
            
            quickSchedulePopup.dataset.scheduleData = JSON.stringify({
                experience: experience,
                dropInfo: dropInfo,
                endTime: endTime
            });
            
            document.body.appendChild(quickSchedulePopup);
        }

        function closeQuickSchedulePopup() {
            if (quickSchedulePopup) {
                quickSchedulePopup.remove();
                quickSchedulePopup = null;
            }
        }

        function confirmQuickSchedule() {
            if (!quickSchedulePopup) return;
            
            const scheduleData = JSON.parse(quickSchedulePopup.dataset.scheduleData);
            const { experience, dropInfo, endTime } = scheduleData;
            
            // Check for conflicts
            const conflict = scheduledSessions.find(session => 
                session.venueId === dropInfo.venue.id && 
                session.spaceId === dropInfo.space.id && 
                session.date === dropInfo.date && 
                ((dropInfo.time >= session.startTime && dropInfo.time < session.endTime) ||
                 (endTime > session.startTime && endTime <= session.endTime))
            );
            
            if (conflict) {
                alert(`Conflict detected! Space "${dropInfo.space.name}" is already booked.`);
                closeQuickSchedulePopup();
                return;
            }
            
            const newSession = {
                id: scheduledSessions.length > 0 ? Math.max(...scheduledSessions.map(s => s.id)) + 1 : 1,
                experienceId: experience.id,
                experienceName: experience.name,
                experienceType: experience.type,
                venueId: dropInfo.venue.id,
                venueName: dropInfo.venue.name,
                spaceId: dropInfo.space.id,
                spaceName: dropInfo.space.name,
                date: dropInfo.date,
                startTime: dropInfo.time,
                endTime: endTime,
                bufferTime: eventConfig.defaultBufferTime,
                maxCapacity: Math.min(dropInfo.space.capacity, 50),
                sessionNotes: `Scheduled via drag & drop`
            };
            
            scheduledSessions.push(newSession);
            
            // Save to Firebase
            saveToFirebase('scheduledSessions', scheduledSessions);
            
            renderAgendaView();
            closeQuickSchedulePopup();
        }

        // Modal functions
        function openScheduleModal(space = null, date = null, time = null) {
            populateScheduleForm();
            
            if (space) {
                document.getElementById('scheduleVenue').value = space.venueId || selectedVenue?.id || '';
                populateScheduleSpaces();
                document.getElementById('scheduleSpace').value = space.id;
            }
            
            if (date) {
                document.getElementById('scheduleDate').value = date;
            }
            
            if (time) {
                document.getElementById('scheduleStartTime').value = time;
                updateScheduleEndTime();
            }
            
            document.getElementById('scheduleModal').style.display = 'block';
        }

        function closeScheduleModal() {
            document.getElementById('scheduleModal').style.display = 'none';
            document.getElementById('scheduleForm').reset();
        }

        function populateScheduleForm() {
            const experienceSelect = document.getElementById('scheduleExperience');
            experienceSelect.innerHTML = '<option value="">Select experience...</option>';
            experiences.forEach(exp => {
                const option = document.createElement('option');
                option.value = exp.id;
                option.textContent = `${exp.name} (${exp.duration}min)`;
                option.dataset.duration = exp.duration;
                experienceSelect.appendChild(option);
            });
            
            const venueSelect = document.getElementById('scheduleVenue');
            venueSelect.innerHTML = '<option value="">Select venue...</option>';
            venues.forEach(venue => {
                const option = document.createElement('option');
                option.value = venue.id;
                option.textContent = venue.name;
                venueSelect.appendChild(option);
            });
            
            const dateSelect = document.getElementById('scheduleDate');
            dateSelect.innerHTML = '<option value="">Select date...</option>';
            const eventDays = eventConfig.dailySchedules.filter(day => day.isEventDay);
            eventDays.forEach(day => {
                const option = document.createElement('option');
                option.value = day.date;
                option.textContent = new Date(day.date).toLocaleDateString();
                dateSelect.appendChild(option);
            });
            
            document.getElementById('bufferTime').value = eventConfig.defaultBufferTime;
        }

        function populateScheduleSpaces() {
            const venueId = parseInt(document.getElementById('scheduleVenue').value);
            const spaceSelect = document.getElementById('scheduleSpace');
            
            spaceSelect.innerHTML = '<option value="">Select space...</option>';
            
            if (venueId) {
                const venue = venues.find(v => v.id === venueId);
                if (venue) {
                    venue.spaces.forEach(space => {
                        const option = document.createElement('option');
                        option.value = space.id;
                        option.textContent = `${space.name} (${space.capacity} people)`;
                        spaceSelect.appendChild(option);
                    });
                }
            }
        }

        function updateScheduleEndTime() {
            const experienceSelect = document.getElementById('scheduleExperience');
            const startTimeInput = document.getElementById('scheduleStartTime');
            const endTimeInput = document.getElementById('scheduleEndTime');
            const bufferTimeInput = document.getElementById('bufferTime');
            
            const selectedOption = experienceSelect.options[experienceSelect.selectedIndex];
            const startTime = startTimeInput.value;
            
            if (selectedOption && selectedOption.dataset.duration && startTime) {
                const duration = parseInt(selectedOption.dataset.duration);
                const bufferTime = parseInt(bufferTimeInput.value) || 0;
                const totalMinutes = duration + bufferTime;
                
                const startDate = new Date(`1970-01-01T${startTime}:00Z`);
                startDate.setUTCMinutes(startDate.getUTCMinutes() + totalMinutes);
                
                endTimeInput.value = startDate.toISOString().substr(11, 5);
            }
        }

        // Form submission
        document.getElementById('scheduleForm').addEventListener('submit', function(e) {
            e.preventDefault();
            
            const experienceId = parseInt(document.getElementById('scheduleExperience').value);
            const venueId = parseInt(document.getElementById('scheduleVenue').value);
            const spaceId = parseInt(document.getElementById('scheduleSpace').value);
            const date = document.getElementById('scheduleDate').value;
            const startTime = document.getElementById('scheduleStartTime').value;
            const endTime = document.getElementById('scheduleEndTime').value;
            const bufferTime = parseInt(document.getElementById('bufferTime').value);
            const maxCapacity = parseInt(document.getElementById('maxCapacity').value);
            const sessionNotes = document.getElementById('sessionNotes').value;
            
            const experience = experiences.find(exp => exp.id === experienceId);
            const venue = venues.find(v => v.id === venueId);
            const space = venue?.spaces.find(s => s.id === spaceId);
            
            if (!experience || !venue || !space) {
                alert('Please select valid experience, venue, and space.');
                return;
            }
            
            // Check for conflicts
            const conflict = scheduledSessions.find(session => 
                session.venueId === venueId && 
                session.spaceId === spaceId && 
                session.date === date && 
                ((startTime >= session.startTime && startTime < session.endTime) ||
                 (endTime > session.startTime && endTime <= session.endTime))
            );
            
            if (conflict) {
                alert(`Conflict detected! Space "${space.name}" is already booked from ${conflict.startTime} to ${conflict.endTime}.`);
                return;
            }
            
            const newSession = {
                id: scheduledSessions.length > 0 ? Math.max(...scheduledSessions.map(s => s.id)) + 1 : 1,
                experienceId: experienceId,
                experienceName: experience.name,
                experienceType: experience.type,
                venueId: venueId,
                venueName: venue.name,
                spaceId: spaceId,
                spaceName: space.name,
                date: date,
                startTime: startTime,
                endTime: endTime,
                bufferTime: bufferTime,
                maxCapacity: maxCapacity,
                sessionNotes: sessionNotes
            };
            
            scheduledSessions.push(newSession);
            
            // Save to Firebase
            saveToFirebase('scheduledSessions', scheduledSessions);
            
            renderAgendaView();
            closeScheduleModal();
            
            alert(`✅ Session scheduled successfully!`);
        });

        // Fullscreen agenda functions
        function openFullscreenAgenda() {
            fullscreenViewMode = agendaViewMode;
            fullscreenTimeMode = agendaTimeMode;
            fullscreenSelectedDate = selectedAgendaDate;
            
            document.getElementById('fullscreenGridBtn').classList.toggle('active', fullscreenViewMode === 'grid');
            document.getElementById('fullscreenListBtn').classList.toggle('active', fullscreenViewMode === 'list');
            document.getElementById('fullscreenMultidayBtn').classList.toggle('active', fullscreenTimeMode === 'multiday');
            document.getElementById('fullscreenSingledayBtn').classList.toggle('active', fullscreenTimeMode === 'single');
            document.getElementById('fullscreenDateSelector').style.display = fullscreenTimeMode === 'single' ? 'flex' : 'none';
            
            if (selectedVenue) {
                document.getElementById('fullscreenTitle').textContent = `${selectedVenue.name} - Event Schedule`;
            } else {
                document.getElementById('fullscreenTitle').textContent = `${eventConfig.eventName} - Full Schedule`;
            }
            
            populateFullscreenDaySelector();
            document.getElementById('fullscreenModal').classList.add('active');
            document.addEventListener('keydown', handleFullscreenEscape);
            renderFullscreenAgenda();
        }

        function closeFullscreenAgenda() {
            document.getElementById('fullscreenModal').classList.remove('active');
            document.removeEventListener('keydown', handleFullscreenEscape);
        }

        function handleFullscreenEscape(event) {
            if (event.key === 'Escape') {
                closeFullscreenAgenda();
            }
        }

        function setFullscreenViewMode(mode) {
            fullscreenViewMode = mode;
            document.getElementById('fullscreenGridBtn').classList.toggle('active', mode === 'grid');
            document.getElementById('fullscreenListBtn').classList.toggle('active', mode === 'list');
            document.getElementById('fullscreen-agenda-grid').classList.toggle('active', mode === 'grid');
            document.getElementById('fullscreen-agenda-list').classList.toggle('active', mode === 'list');
            renderFullscreenAgenda();
        }

        function setFullscreenTimeMode(mode) {
            fullscreenTimeMode = mode;
            document.getElementById('fullscreenMultidayBtn').classList.toggle('active', mode === 'multiday');
            document.getElementById('fullscreenSingledayBtn').classList.toggle('active', mode === 'single');
            document.getElementById('fullscreenDateSelector').style.display = mode === 'single' ? 'flex' : 'none';
            
            if (mode === 'single' && !fullscreenSelectedDate) {
                const eventDays = eventConfig.dailySchedules.filter(day => day.isEventDay);
                if (eventDays.length > 0) {
                    fullscreenSelectedDate = eventDays[0].date;
                }
            }
            renderFullscreenAgenda();
        }

        function setFullscreenSelectedDate(date) {
            fullscreenSelectedDate = date;
            renderFullscreenAgenda();
        }

        function populateFullscreenDaySelector() {
            const daySelect = document.getElementById('fullscreenDaySelect');
            daySelect.innerHTML = '';
            
            const eventDays = eventConfig.dailySchedules.filter(day => day.isEventDay);
            eventDays.forEach(day => {
                const option = document.createElement('option');
                option.value = day.date;
                
                const date = new Date(day.date + 'T00:00:00');
                const dayName = date.toLocaleDateString('en-US', { weekday: 'short' });
                const dateFormatted = date.toLocaleDateString('en-US', { month: 'short', day: 'numeric' });
                
                option.textContent = `${dayName} ${dateFormatted}`;
                daySelect.appendChild(option);
            });
            
            if (fullscreenSelectedDate) {
                daySelect.value = fullscreenSelectedDate;
            }
        }

        function renderFullscreenAgenda() {
            if (fullscreenViewMode === 'grid') {
                renderFullscreenAgendaGrid();
            } else {
                renderFullscreenAgendaList();
            }
        }

        function renderFullscreenAgendaGrid() {
            const gridContainer = document.getElementById('fullscreen-grid-container');
            
            const eventDays = fullscreenTimeMode === 'single' 
                ? eventConfig.dailySchedules.filter(day => day.isEventDay && day.date === fullscreenSelectedDate)
                : eventConfig.dailySchedules.filter(day => day.isEventDay);
            
            if (eventDays.length === 0) {
                gridContainer.innerHTML = '<div style="grid-column: 1/-1; padding: 40px; text-align: center; color: #6b7280;">No event days configured.</div>';
                return;
            }

            const spaces = selectedVenue ? selectedVenue.spaces : getAllSpaces();
            
            if (spaces.length === 0) {
                gridContainer.innerHTML = '<div style="grid-column: 1/-1; padding: 40px; text-align: center; color: #6b7280;">No spaces available.</div>';
                return;
            }

            const dayToShow = eventDays[0];
            const timeSlots = generateTimeSlots(dayToShow);
            
            gridContainer.style.setProperty('--spaces-count', spaces.length);
            gridContainer.style.setProperty('--time-slots', timeSlots.length);
            
            renderGridStructure(gridContainer, spaces, timeSlots, dayToShow);
        }

        function renderFullscreenAgendaList() {
            const listContainer = document.getElementById('fullscreen-agenda-list');
            
            const eventDays = fullscreenTimeMode === 'single' 
                ? eventConfig.dailySchedules.filter(day => day.isEventDay && day.date === fullscreenSelectedDate)
                : eventConfig.dailySchedules.filter(day => day.isEventDay);
            
            if (eventDays.length === 0) {
                listContainer.innerHTML = '<div style="padding: 40px; text-align: center; color: #6b7280;">No event days configured.</div>';
                return;
            }

            listContainer.innerHTML = '';
            
            eventDays.forEach(day => {
                const daySection = document.createElement('div');
                daySection.className = 'day-section';
                
                const date = new Date(day.date + 'T00:00:00');
                const dayName = date.toLocaleDateString('en-US', { weekday: 'long' });
                const dateFormatted = date.toLocaleDateString('en-US', { month: 'long', day: 'numeric', year: 'numeric' });
                
                const daySessions = scheduledSessions.filter(session => session.date === day.date);
                const venueFilter = selectedVenue ? daySessions.filter(session => session.venueId === selectedVenue.id) : daySessions;
                
                daySection.innerHTML = `
                    <div class="day-header">
                        <div class="day-title">${dayName}</div>
                        <div class="day-info">${dateFormatted} • ${day.startTime} - ${day.endTime} • ${venueFilter.length} sessions</div>
                    </div>
                    <div class="day-content" id="fullscreen-day-content-${day.date}">
                    </div>
                `;
                
                listContainer.appendChild(daySection);
                renderDayContentForContainer(`fullscreen-day-content-${day.date}`, day, venueFilter);
            });
        }

        // Shared grid rendering function
        function renderGridStructure(gridContainer, spaces, timeSlots, dayToShow) {
            gridContainer.innerHTML = '';
            
            // Header row
            const timeHeaderCell = document.createElement('div');
            timeHeaderCell.className = 'grid-header';
            timeHeaderCell.textContent = 'Time';
            gridContainer.appendChild(timeHeaderCell);
            
            spaces.forEach(space => {
                const spaceHeaderCell = document.createElement('div');
                spaceHeaderCell.className = 'grid-header';
                spaceHeaderCell.innerHTML = `<strong>${space.name}</strong><br><small>${space.capacity} people</small>`;
                gridContainer.appendChild(spaceHeaderCell);
            });
            
            // Time slot rows
            timeSlots.forEach(timeSlot => {
                const timeCell = document.createElement('div');
                timeCell.className = 'grid-time';
                timeCell.textContent = formatTime12Hour(timeSlot);
                gridContainer.appendChild(timeCell);
                
                spaces.forEach(space => {
                    const cell = document.createElement('div');
                    cell.className = 'grid-cell';
                    
                    const session = findSessionInSlot(selectedVenue?.id || space.venueId, space.id, dayToShow.date, timeSlot);
                    if (session) {
                        const slotsSpanned = calculateSessionSlots(session);
                        const sessionStartIndex = timeSlots.indexOf(session.startTime);
                        const currentSlotIndex = timeSlots.indexOf(timeSlot);
                        
                        if (sessionStartIndex === currentSlotIndex) {
                            cell.classList.add('occupied');
                            const cellHeight = slotsSpanned * 40 - 2;
                            
                            cell.innerHTML = `
                                <div class="experience-session ${session.experienceType.toLowerCase()} multi-slot" 
                                     style="height: ${cellHeight}px;"
                                     data-session-id="${session.id}"
                                     title="${session.experienceName}"
                                     onmousedown="startSessionDrag(event, ${session.id})">
                                    <div class="experience-session-content">
                                        <div class="session-main-title">${session.experienceName}</div>
                                        <div class="session-meta">${formatTime12Hour(session.startTime)} - ${formatTime12Hour(session.endTime)}<br>
                                        ${session.maxCapacity} people • ${session.spaceName}</div>
                                        
                                        <div class="session-actions">
                                            <div class="session-action-btn info" onclick="event.stopPropagation(); showSessionInfo(${session.id})" title="Session Info">ℹ️</div>
                                            <div class="session-action-btn delete" onclick="event.stopPropagation(); deleteSession(${session.id})" title="Delete Session">🗑️</div>
                                        </div>
                                        
                                        <div class="session-resize-handle" 
                                             onmousedown="event.stopPropagation(); startSessionResize(event, ${session.id})"
                                             title="Duplicate sessions by dragging down"></div>
                                    </div>
                                </div>
                            `;
                        } else if (currentSlotIndex > sessionStartIndex && currentSlotIndex < sessionStartIndex + slotsSpanned) {
                            cell.classList.add('occupied');
                            cell.style.position = 'relative';
                        }
                    }
                    
                    cell.addEventListener('click', (cellEvent) => {
                        if (!session && !draggedExperience && !isDraggingSession) {
                            openScheduleModal(space, dayToShow.date, timeSlot);
                        }
                    });
                    
                    gridContainer.appendChild(cell);
                });
            });
        }

        function renderDayContentForContainer(containerId, day, sessions) {
            const dayContent = document.getElementById(containerId);
            if (!dayContent) return;
            
            const timeSlots = generateTimeSlots(day);
            
            timeSlots.forEach(timeSlot => {
                const slotSessions = sessions.filter(session => session.startTime === timeSlot);
                
                const timeSlotDiv = document.createElement('div');
                timeSlotDiv.className = 'time-slot';
                
                timeSlotDiv.innerHTML = `
                    <div class="time-label">${formatTime12Hour(timeSlot)}</div>
                    <div class="experiences-in-slot">
                        ${slotSessions.length > 0 
                            ? slotSessions.map(session => `
                                <div class="experience-session ${session.experienceType.toLowerCase()}" onclick="showSessionInfo(${session.id})">
                                    <div class="session-info">
                                        <div class="session-title">${session.experienceName}</div>
                                        <div class="session-details">${session.spaceName} • ${session.maxCapacity} people • ${formatTime12Hour(session.startTime)}-${formatTime12Hour(session.endTime)}</div>
                                    </div>
                                </div>
                              `).join('')
                            : '<div class="empty-slot">No sessions scheduled</div>'
                        }
                    </div>
                `;
                
                dayContent.appendChild(timeSlotDiv);
            });
        }

        // Export/Import functions
        function exportPlan() {
            const plan = {
                appSettings: appSettings,
                eventConfig: eventConfig,
                venues: venues,
                experiences: experiences,
                scheduledSessions: scheduledSessions,
                metadata: {
                    totalExperiences: experiences.length,
                    totalVenues: venues.length,
                    totalSessions: scheduledSessions.length,
                    eventDays: eventConfig.dailySchedules.filter(d => d.isEventDay).length,
                    appVersion: '3.0',
                    exportedAt: new Date().toISOString(),
                    exportType: 'complete',
                    projectId: currentProjectId
                }
            };

            const dataStr = JSON.stringify(plan, null, 2);
            const dataBlob = new Blob([dataStr], { type: 'application/json' });
            const url = URL.createObjectURL(dataBlob);
            const link = document.createElement('a');
            link.href = url;
            link.download = `xr-event-plan-${new Date().toISOString().split('T')[0]}.json`;
            document.body.appendChild(link);
            link.click();
            document.body.removeChild(link);
            URL.revokeObjectURL(url);
            
            setTimeout(() => {
                alert('✅ Export successful! Your complete plan has been downloaded.');
            }, 100);
        }

        function importData() {
            const input = document.createElement('input');
            input.type = 'file';
            input.accept = '.json,application/json';
            
            input.onchange = function(event) {
                const file = event.target.files[0];
                if (!file) return;

                const reader = new FileReader();
                reader.onload = function(e) {
                    try {
                        const importedData = JSON.parse(e.target.result);
                        
                        if (confirm('This will replace ALL current data. Continue?')) {
                            appSettings = { ...defaultSettings, ...importedData.appSettings };
                            eventConfig = { ...defaultEventConfig, ...importedData.eventConfig };
                            venues = importedData.venues || [];
                            experiences = importedData.experiences || [];
                            scheduledSessions = importedData.scheduledSessions || [];
                            
                            // Save all imported data to Firebase
                            saveToFirebase('appSettings', appSettings);
                            saveToFirebase('eventConfig', eventConfig);
                            saveToFirebase('venues', venues);
                            saveToFirebase('experiences', experiences);
                            saveToFirebase('scheduledSessions', scheduledSessions);
                            
                            updateHeaderDisplay();
                            renderVenues();
                            renderExperiences();
                            
                            if (selectedVenue && !venues.find(v => v.id === selectedVenue.id)) {
                                selectedVenue = null;
                            }
                            updatePanelTitle();
                            
                            if (currentView === 'agenda') {
                                renderAgendaView();
                            }
                            
                            alert('✅ Import successful!');
                        }
                    } catch (error) {
                        alert('❌ Error reading file. Please ensure it is a valid JSON file.');
                        console.error('Import error:', error);
                    }
                };
                reader.readAsText(file);
            };
            
            input.click();
        }

        // Add keyboard support for settings inputs
        document.addEventListener('keypress', function(e) {
            if (e.key === 'Enter') {
                if (e.target.id === 'newHardware') addHardwareOption();
                if (e.target.id === 'newSoftware') addSoftwareOption();
                if (e.target.id === 'newSpace') addSpaceOption();
            }
        });

        // Add event listeners for date changes in settings modal
        document.addEventListener('change', function(e) {
            if (e.target.id === 'eventStartDate') {
                eventConfig.startDate = e.target.value;
                renderDailySchedules();
            } else if (e.target.id === 'eventEndDate') {
                eventConfig.endDate = e.target.value;
                renderDailySchedules();
            }
        });

        // Close modals when clicking outside
        window.onclick = function(event) {
            const modals = ['scheduleModal', 'settingsModal', 'experienceModal', 'venueModal'];
            modals.forEach(modalId => {
                const modal = document.getElementById(modalId);
                if (event.target === modal) {
                    modal.style.display = 'none';
                    
                    // Clean up any editing states
                    if (modalId === 'experienceModal') {
                        editingExperience = null;
                    } else if (modalId === 'venueModal') {
                        editingVenue = null;
                        editingSpace = null;
                        window.tempVenueSpaces = [];
                    }
                }
            });
            
            if (quickSchedulePopup && !quickSchedulePopup.contains(event.target)) {
                closeQuickSchedulePopup();
            }
            
            // Cancel any ongoing drag operations if clicking outside
            if (isDraggingSession && !event.target.closest('.grid-cell')) {
                // Cancel session drag
                if (dragPreviewElement) {
                    dragPreviewElement.remove();
                    dragPreviewElement = null;
                }
                removeSessionDropZones();
                clearDragPreview();
                
                const instructionMsg = document.getElementById('dragInstruction');
                if (instructionMsg) {
                    instructionMsg.remove();
                }
                
                const draggingElement = document.querySelector('.dragging-move');
                if (draggingElement) {
                    draggingElement.classList.remove('dragging-move');
                }
                
                document.removeEventListener('mousemove', handleSessionDragMove);
                document.removeEventListener('mouseup', handleSessionDragEnd);
                
                isDraggingSession = false;
                draggedSession = null;
                draggedExperience = null;
                
                renderAgendaView();
            }
            
            if (isResizingSession) {
                // Cancel resize
                const draggingElement = document.querySelector('.dragging-resize');
                if (draggingElement) {
                    draggingElement.classList.remove('dragging-resize');
                }
                
                clearDuplicatePreview();
                
                document.removeEventListener('mousemove', handleSessionResizeMouseMove);
                document.removeEventListener('mouseup', handleSessionResizeMouseUp);
                
                isResizingSession = false;
                draggedSession = null;
                
                renderAgendaView();
            }
        }

        // Initialize Firebase on page load
        window.onload = function() {
            initializeFirebase();
        };
    </script>
</body>
</html>